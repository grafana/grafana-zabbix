{"version":3,"sources":["../../src/panel-triggers/ack-tooltip.directive.js"],"names":["angular","$","System","config","paths","tether","getConfig","baseURL","Drop","amdRequire","drop","module","directive","$sanitize","$compile","buttonTemplate","scope","ack","trigger","onAck","context","link","element","acknowledges","$button","appendTo","click","tooltip","length","time","user","message","addAckButtonTemplate","target","content","position","classes","openOn","hoverCloseDelay","tetherOptions","constraints","to","pin","attachment","open","on","closeDrop","onAddAckButtonClick","inputTemplate","$input","$addAckButton","replaceWith","onAckCancelButtonClick","onAckSendlButtonClick","value","bind","then","setTimeout","destroy","err","console","log","contents"],"mappings":"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","file":"ack-tooltip.directive.js","sourcesContent":["import angular from 'angular';\r\nimport $ from 'jquery';\r\n\r\nSystem.config({\r\n  paths: {\r\n    tether: System.getConfig().baseURL + \"plugins/alexanderzobnin-zabbix-app/vendor/npm/tether.min.js\"\r\n  }\r\n});\r\n\r\nlet Drop;\r\nSystem.amdRequire([\"plugins/alexanderzobnin-zabbix-app/vendor/npm/drop.min.js\"], (drop) => {\r\n  Drop = drop;\r\n});\r\n\r\n/** @ngInject */\r\nangular\r\n  .module('grafana.directives')\r\n  .directive('ackTooltip', function($sanitize, $compile) {\r\n    let buttonTemplate = '<a bs-tooltip=\"\\'Acknowledges ({{trigger.acknowledges.length}})\\'\"' +\r\n                          '<i ng-class=\"' +\r\n                            \"{'fa fa-comments': trigger.acknowledges.length, \" +\r\n                            \"'fa fa-comments-o': !trigger.acknowledges.length, \" +\r\n                          '}\"></i></a>';\r\n\r\n    return {\r\n      scope: {\r\n        ack: \"=\",\r\n        trigger: \"=\",\r\n        onAck: \"=\",\r\n        context: \"=\"\r\n      },\r\n      link: function(scope, element) {\r\n        let acknowledges = scope.ack;\r\n        let $button = $(buttonTemplate);\r\n        $button.appendTo(element);\r\n\r\n        $button.click(function() {\r\n          let tooltip = '<div>';\r\n\r\n          if (acknowledges && acknowledges.length) {\r\n            tooltip += '<table class=\"table\"><thead><tr>' +\r\n                        '<th class=\"ack-time\">Time</th>' +\r\n                        '<th class=\"ack-user\">User</th>' +\r\n                        '<th class=\"ack-comments\">Comments</th>' +\r\n                        '</tr></thead><tbody>';\r\n            for (let ack of acknowledges) {\r\n              tooltip += '<tr><td>' + ack.time + '</td>' +\r\n                         '<td>' + ack.user + '</td>' +\r\n                         '<td>' + ack.message + '</td></tr>';\r\n            }\r\n            tooltip += '</tbody></table>';\r\n          } else {\r\n            tooltip += 'Add acknowledge';\r\n          }\r\n\r\n          let addAckButtonTemplate = '<div class=\"ack-add-button\">' +\r\n                                       '<button id=\"add-acknowledge-btn\"' +\r\n                                         'class=\"btn btn-mini btn-inverse gf-form-button\">' +\r\n                                         '<i class=\"fa fa-plus\"></i>' +\r\n                                       '</button></div>';\r\n          tooltip += addAckButtonTemplate;\r\n          tooltip += '</div>';\r\n\r\n          let drop = new Drop({\r\n            target: element[0],\r\n            content: tooltip,\r\n            position: \"bottom left\",\r\n            classes: 'drop-popover ack-tooltip',\r\n            openOn: 'hover',\r\n            hoverCloseDelay: 500,\r\n            tetherOptions: {\r\n              constraints: [{to: 'window', pin: true, attachment: \"both\"}]\r\n            }\r\n          });\r\n\r\n          drop.open();\r\n          drop.on('close', closeDrop);\r\n\r\n          $('#add-acknowledge-btn').on('click', onAddAckButtonClick);\r\n\r\n          function onAddAckButtonClick() {\r\n            let inputTemplate = '<div class=\"ack-input-group\">' +\r\n                                  '<input type=\"text\" id=\"ack-message\">' +\r\n                                  '<button id=\"send-ack-button\"' +\r\n                                    'class=\"btn btn-mini btn-inverse gf-form-button\">' +\r\n                                    'Acknowledge </button>' +\r\n                                  '<button id=\"cancel-ack-button\"' +\r\n                                    'class=\"btn btn-mini btn-inverse gf-form-button\">' +\r\n                                    'Cancel' +\r\n                                  '</button></input></div>';\r\n\r\n            let $input = $(inputTemplate);\r\n            let $addAckButton = $('.ack-tooltip .ack-add-button');\r\n            $addAckButton.replaceWith($input);\r\n            $('.ack-tooltip #cancel-ack-button').on('click', onAckCancelButtonClick);\r\n            $('.ack-tooltip #send-ack-button').on('click', onAckSendlButtonClick);\r\n          }\r\n\r\n          function onAckCancelButtonClick() {\r\n            $('.ack-tooltip .ack-input-group').replaceWith(addAckButtonTemplate);\r\n            $('#add-acknowledge-btn').on('click', onAddAckButtonClick);\r\n          }\r\n\r\n          function onAckSendlButtonClick() {\r\n            let message = $('.ack-tooltip #ack-message')[0].value;\r\n            let onAck = scope.onAck.bind(scope.context);\r\n            onAck(scope.trigger, message).then(() => {\r\n              closeDrop();\r\n            });\r\n          }\r\n\r\n          function closeDrop() {\r\n            setTimeout(function() {\r\n              try {\r\n                drop.destroy();\r\n              } catch (err) {\r\n                console.log('drop.destroy() error: ', err.message);\r\n              }\r\n            });\r\n          }\r\n\r\n        });\r\n\r\n        $compile(element.contents())(scope);\r\n      }\r\n    };\r\n  });\r\n"]}