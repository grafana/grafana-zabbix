define(["react","lodash","@grafana/ui","emotion","moment","@grafana/runtime","@grafana/data","app/core/utils/datemath","jquery","app/plugins/sdk","app/core/utils/kbn","app/core/core_module","app/core/core","app/core/table_model","app/core/config","angular"],(function(e,t,n,r,a,o,i,s,u,c,l,p,f,m,d,h){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=75)}([function(t,n){t.exports=e},function(e,n){e.exports=t},,function(e,t,n){"use strict";n.d(t,"t",(function(){return p})),n.d(t,"e",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"c",(function(){return h})),n.d(t,"r",(function(){return v})),n.d(t,"o",(function(){return g})),n.d(t,"k",(function(){return b})),n.d(t,"l",(function(){return E})),n.d(t,"i",(function(){return T})),n.d(t,"a",(function(){return x})),n.d(t,"d",(function(){return I})),n.d(t,"n",(function(){return S})),n.d(t,"q",(function(){return w})),n.d(t,"g",(function(){return A})),n.d(t,"s",(function(){return P})),n.d(t,"b",(function(){return O})),n.d(t,"h",(function(){return R})),n.d(t,"j",(function(){return D})),n.d(t,"p",(function(){return C})),n.d(t,"m",(function(){return N}));var r=n(1),a=n.n(r),o=n(9),i=n.n(o),s=n(20),u=n.n(s),c=n(4),l=n(7),p=/\$(\w+)|\[\[([\s\S]+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::(\w+))?}/g;function f(e,t){for(var n,r,o,i,s,u=t.substring(t.indexOf("[")+1,t.lastIndexOf("]")),c=(n=u,r=[],o=!1,i=!1,s="",a.a.forEach(n,(function(e){'"'===e&&i?s+=e:'"'===e&&o?o=!1:'"'!==e||o?"["!==e||o?"]"!==e||o?","!==e||o||i?s+=e:(r.push(s),s=""):i=!1:i=!0:o=!0})),r.push(s),r),l=c.length;l>=1;l--)e=e.replace("$"+l,c[l-1]);return e}function m(e){return a.a.forEach(e,(function(e){return e.item=e.name,e.name=f(e.item,e.key_),e})),e}var d=/{\$[A-Z0-9_\.]+}/g;function h(e){return d.test(e)}function v(e,t,n){var r=n?e.url:e.name,o=r.match(d);return a.a.forEach(o,(function(o){var i=a.a.filter(t,(function(t){if(t.hostid){if(n){var r=!1;return a.a.forEach(e.hosts,(function(e){e.hostid===t.hostid&&(r=!0)})),r}return t.hostid===e.hostid}return!0})),s=a.a.find(i,{macro:o});if(s&&s.value){var u=s.value,c=new RegExp(function(e){return e=e.replace(/\$/,"\\$")}(o));r=r.replace(c,u)}})),r}function g(e){var t,n=[];a.a.each(function(e){var t;if(function(e){return/^\{.+\}$/.test(e)}(e)){var n=e.match(/\{[^\{\}]*\}|\{\/.*\/\}/g);t=a.a.map(n,(function(e){return a.a.trim(e,"{}")}))}else t=e.split(".");return t}(e),(function(e){"*"===e&&(e="/.*/"),n.push(e)}));var r=a.a.zipObject(["group","host","app","item"],n);switch(4===n.length&&"/.*/"===r.app&&(r.app=""),n.length){case 1:t=l.b.Group;break;case 2:t=l.b.Host;break;case 3:t=l.b.Application;break;case 4:t=l.b.Item}return{queryType:t,group:r.group||"",host:r.host||"",application:r.app||"",item:r.item||""}}var y=/^\/(.*)\/([gmi]*)$/m;function b(e){return y.test(e)}function E(e,t){if(/^\$\w+/.test(e)){var n=a.a.map(t,(function(e){return"$"+e.name}));return a.a.includes(n,e)}return!1}function T(e){var t=e.to.diff(e.from),n=Math.round(t/1e3),r=u.a.secondsToHms(t/1e3);return{__range_ms:{text:t,value:t},__range_s:{text:n,value:n},__range:{text:r,value:r},__range_series:{text:c.j,value:c.j}}}function x(e){var t=e.match(y),n=t[1],r=""!==t[2]?t[2]:void 0;return new RegExp(n,r)}function I(e){return e.replace(/[\\^$*+?.()|[\]{}\/]/g,"\\$&")}function S(e){var t=/(^[\d]+)(y|M|w|d|h|m|s)/g.exec(e);return i.a.duration(Number(t[1]),t[2]).valueOf()}function w(e){var t=/^([\+\-]*)([\d]+)(y|M|w|d|h|m|s)/g.exec(e);return"+"===t[1]?0-i.a.duration(Number(t[2]),t[3]).valueOf():i.a.duration(Number(t[2]),t[3]).valueOf()}function A(e){if(e.length){var t="<br><br>Acknowledges:<br><table><tr><td><b>Time</b></td><td><b>User</b></td><td><b>Comments</b></td></tr>";return a.a.each(a.a.map(e,(function(e){return"<tr><td><i>"+i.a.unix(e.clock).format("DD MMM YYYY HH:mm:ss")+"</i></td><td>"+e.alias+" ("+e.name+" "+e.surname+")</td><td>"+e.message+"</td></tr>"})),(function(e){t=t.concat(e)})),t=t.concat("</table>")}return""}function P(e){return function(t){for(var n=0;n<e.length;n++)t=e[n].call(this,t);return t}}function O(e){return e.replace(/\s+/g," ").trim()}function R(e,t){if(void 0===t&&(t=0),0===e.length)return 1;var n=e[0];return a.a.isArray(n)?R(n,t+1):t+1}function D(e){return!isNaN(parseFloat(e))&&isFinite(e)}function C(e){if(!e)return[];var t=a.a.map(e.split(","),(function(e){return e.trim()}));return t=a.a.map(t,(function(e){var t=e.split(":");return{tag:t[0].trim(),value:t[1].trim()}}))}function N(e){return e||[]}},function(e,t,n){"use strict";n.d(t,"l",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"f",(function(){return o})),n.d(t,"e",(function(){return i})),n.d(t,"h",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"i",(function(){return c})),n.d(t,"g",(function(){return l})),n.d(t,"q",(function(){return p})),n.d(t,"p",(function(){return f})),n.d(t,"m",(function(){return m})),n.d(t,"n",(function(){return d})),n.d(t,"o",(function(){return h})),n.d(t,"k",(function(){return v})),n.d(t,"c",(function(){return g})),n.d(t,"j",(function(){return y})),n.d(t,"b",(function(){return b}));var r="alexanderzobnin-zabbix-triggers-panel",a=1,o=0,i=1,s=2,u=3,c=4,l=5,p=0,f=1,m=2,d=4,h=8,v=[{val:0,text:"Not classified"},{val:1,text:"Information"},{val:2,text:"Warning"},{val:3,text:"Average"},{val:4,text:"High"},{val:5,text:"Disaster"}],g=3600,y="range_series",b=1001},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t,n){"use strict";var r,a;n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a})),function(e){e.Group="group",e.Host="host",e.Application="application",e.Item="item",e.ItemValues="itemValues"}(r||(r={})),function(e){e.Problems="problems",e.Recent="recent",e.History="history"}(a||(a={}))},,function(e,t){e.exports=a},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(26),i=n(25),s=i.MAX_LENGTH,u=i.MAX_SAFE_INTEGER,c=n(22),l=c.re,p=c.t,f=n(31).compareIdentifiers,m=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"object"===r(n)||(n={loose:!!n,includePrerelease:!1}),t instanceof e){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if("string"!=typeof t)throw new TypeError("Invalid Version: ".concat(t));if(t.length>s)throw new TypeError("version is longer than ".concat(s," characters"));o("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;var a=t.trim().match(n.loose?l[p.LOOSE]:l[p.FULL]);if(!a)throw new TypeError("Invalid Version: ".concat(t));if(this.raw=t,this.major=+a[1],this.minor=+a[2],this.patch=+a[3],this.major>u||this.major<0)throw new TypeError("Invalid major version");if(this.minor>u||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>u||this.patch<0)throw new TypeError("Invalid patch version");a[4]?this.prerelease=a[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<u)return t}return e})):this.prerelease=[],this.build=a[5]?a[5].split("."):[],this.format()}var t,n,i;return t=e,(n=[{key:"format",value:function(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}},{key:"toString",value:function(){return this.version}},{key:"compare",value:function(t){if(o("SemVer.compare",this.version,this.options,t),!(t instanceof e)){if("string"==typeof t&&t===this.version)return 0;t=new e(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}},{key:"compareMain",value:function(t){return t instanceof e||(t=new e(t,this.options)),f(this.major,t.major)||f(this.minor,t.minor)||f(this.patch,t.patch)}},{key:"comparePre",value:function(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;var n=0;do{var r=this.prerelease[n],a=t.prerelease[n];if(o("prerelease compare",n,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return f(r,a)}while(++n)}},{key:"compareBuild",value:function(t){t instanceof e||(t=new e(t,this.options));var n=0;do{var r=this.build[n],a=t.build[n];if(o("prerelease compare",n,r,a),void 0===r&&void 0===a)return 0;if(void 0===a)return 1;if(void 0===r)return-1;if(r!==a)return f(r,a)}while(++n)}},{key:"inc",value:function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: ".concat(e))}return this.format(),this.raw=this.version,this}}])&&a(t.prototype,n),i&&a(t,i),e}();e.exports=m},function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"d",(function(){return p}));var r=n(1),a=n.n(r),o=n(9),i=n.n(o),s=n(3);function u(e,t){try{var n=s.n(t);return Date.now()-1e3*e.timestamp<n}catch(e){return!1}}function c(e,t){var n=t||"DD MMM YYYY HH:mm:ss";return i.a.unix(e).format(n)}var l=function(e){return a.a.find("ABCDEFGHIJKLMNOPQRSTUVWXYZ",(function(t){return a.a.every(e,(function(e){return e.refId!==t}))}))};function p(e,t){var n,r,a,o,i;return t&&Object.keys(t).length>0&&(e+="?"+(n=[],r=/\[\]$/,a=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=function(e,t){t="function"==typeof t?t():null==t?"":t,n[n.length]="boolean"!=typeof t?f(e,!0)+"="+f(t,!0):f(e,!0)},(i=function(e,t){var s,u,c;if(e)if(a(t))for(s=0,u=t.length;s<u;s++)r.test(e)?o(e,t[s]):i(e,t[s]);else if(t&&"[object Object]"===String(t))for(c in t)i(e+"["+c+"]",t[c]);else o(e,t);else if(a(t))for(s=0,u=t.length;s<u;s++)o(t[s].name,t[s].value);else for(c in t)i(c,t[c]);return n})("",t).join("&"))),e}function f(e,t){return encodeURIComponent(e).replace(/%25/gi,"%2525").replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%20/g,t?"%20":"+")}},function(e,t){e.exports=s},function(e,t){e.exports=u},function(e,t,n){var r=n(12);e.exports=function(e,t,n){return new r(e,n).compare(new r(t,n))}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){var a=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"object"===r(n)||(n={loose:!!n,includePrerelease:!1}),t instanceof e)return t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease?t:new e(t.raw,n);if(t instanceof i)return this.raw=t.value,this.set=[[t]],this.format(),this;if(this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease,this.raw=t,this.set=t.split(/\s*\|\|\s*/).map((function(e){return a.parseRange(e.trim())})).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: ".concat(t));this.format()}var t,n,o;return t=e,(n=[{key:"format",value:function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range}},{key:"toString",value:function(){return this.range}},{key:"parseRange",value:function(e){var t=this,n=this.options.loose;e=e.trim();var r=n?l[p.HYPHENRANGELOOSE]:l[p.HYPHENRANGE];e=e.replace(r,A(this.options.includePrerelease)),s("hyphen replace",e),e=e.replace(l[p.COMPARATORTRIM],f),s("comparator trim",e,l[p.COMPARATORTRIM]),e=(e=(e=e.replace(l[p.TILDETRIM],m)).replace(l[p.CARETTRIM],d)).split(/\s+/).join(" ");var a=n?l[p.COMPARATORLOOSE]:l[p.COMPARATOR];return e.split(" ").map((function(e){return v(e,t.options)})).join(" ").split(/\s+/).map((function(e){return w(e,t.options)})).filter(this.options.loose?function(e){return!!e.match(a)}:function(){return!0}).map((function(e){return new i(e,t.options)}))}},{key:"intersects",value:function(t,n){if(!(t instanceof e))throw new TypeError("a Range is required");return this.set.some((function(e){return h(e,n)&&t.set.some((function(t){return h(t,n)&&e.every((function(e){return t.every((function(t){return e.intersects(t,n)}))}))}))}))}},{key:"test",value:function(e){if(!e)return!1;if("string"==typeof e)try{e=new u(e,this.options)}catch(e){return!1}for(var t=0;t<this.set.length;t++)if(P(this.set[t],e,this.options))return!0;return!1}}])&&a(t.prototype,n),o&&a(t,o),e}();e.exports=o;var i=n(28),s=n(26),u=n(12),c=n(22),l=c.re,p=c.t,f=c.comparatorTrimReplace,m=c.tildeTrimReplace,d=c.caretTrimReplace,h=function(e,t){for(var n=!0,r=e.slice(),a=r.pop();n&&r.length;)n=r.every((function(e){return a.intersects(e,t)})),a=r.pop();return n},v=function(e,t){return s("comp",e,t),e=E(e,t),s("caret",e),e=y(e,t),s("tildes",e),e=x(e,t),s("xrange",e),e=S(e,t),s("stars",e),e},g=function(e){return!e||"x"===e.toLowerCase()||"*"===e},y=function(e,t){return e.trim().split(/\s+/).map((function(e){return b(e,t)})).join(" ")},b=function(e,t){var n=t.loose?l[p.TILDELOOSE]:l[p.TILDE];return e.replace(n,(function(t,n,r,a,o){var i;return s("tilde",e,t,n,r,a,o),g(n)?i="":g(r)?i=">=".concat(n,".0.0 <").concat(+n+1,".0.0-0"):g(a)?i=">=".concat(n,".").concat(r,".0 <").concat(n,".").concat(+r+1,".0-0"):o?(s("replaceTilde pr",o),i=">=".concat(n,".").concat(r,".").concat(a,"-").concat(o," <").concat(n,".").concat(+r+1,".0-0")):i=">=".concat(n,".").concat(r,".").concat(a," <").concat(n,".").concat(+r+1,".0-0"),s("tilde return",i),i}))},E=function(e,t){return e.trim().split(/\s+/).map((function(e){return T(e,t)})).join(" ")},T=function(e,t){s("caret",e,t);var n=t.loose?l[p.CARETLOOSE]:l[p.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,(function(t,n,a,o,i){var u;return s("caret",e,t,n,a,o,i),g(n)?u="":g(a)?u=">=".concat(n,".0.0").concat(r," <").concat(+n+1,".0.0-0"):g(o)?u="0"===n?">=".concat(n,".").concat(a,".0").concat(r," <").concat(n,".").concat(+a+1,".0-0"):">=".concat(n,".").concat(a,".0").concat(r," <").concat(+n+1,".0.0-0"):i?(s("replaceCaret pr",i),u="0"===n?"0"===a?">=".concat(n,".").concat(a,".").concat(o,"-").concat(i," <").concat(n,".").concat(a,".").concat(+o+1,"-0"):">=".concat(n,".").concat(a,".").concat(o,"-").concat(i," <").concat(n,".").concat(+a+1,".0-0"):">=".concat(n,".").concat(a,".").concat(o,"-").concat(i," <").concat(+n+1,".0.0-0")):(s("no pr"),u="0"===n?"0"===a?">=".concat(n,".").concat(a,".").concat(o).concat(r," <").concat(n,".").concat(a,".").concat(+o+1,"-0"):">=".concat(n,".").concat(a,".").concat(o).concat(r," <").concat(n,".").concat(+a+1,".0-0"):">=".concat(n,".").concat(a,".").concat(o," <").concat(+n+1,".0.0-0")),s("caret return",u),u}))},x=function(e,t){return s("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return I(e,t)})).join(" ")},I=function(e,t){e=e.trim();var n=t.loose?l[p.XRANGELOOSE]:l[p.XRANGE];return e.replace(n,(function(n,r,a,o,i,u){s("xRange",e,n,r,a,o,i,u);var c=g(a),l=c||g(o),p=l||g(i),f=p;return"="===r&&f&&(r=""),u=t.includePrerelease?"-0":"",c?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&f?(l&&(o=0),i=0,">"===r?(r=">=",l?(a=+a+1,o=0,i=0):(o=+o+1,i=0)):"<="===r&&(r="<",l?a=+a+1:o=+o+1),"<"===r&&(u="-0"),n="".concat(r+a,".").concat(o,".").concat(i).concat(u)):l?n=">=".concat(a,".0.0").concat(u," <").concat(+a+1,".0.0-0"):p&&(n=">=".concat(a,".").concat(o,".0").concat(u," <").concat(a,".").concat(+o+1,".0-0")),s("xRange return",n),n}))},S=function(e,t){return s("replaceStars",e,t),e.trim().replace(l[p.STAR],"")},w=function(e,t){return s("replaceGTE0",e,t),e.trim().replace(l[t.includePrerelease?p.GTE0PRE:p.GTE0],"")},A=function(e){return function(t,n,r,a,o,i,s,u,c,l,p,f,m){return n=g(r)?"":g(a)?">=".concat(r,".0.0").concat(e?"-0":""):g(o)?">=".concat(r,".").concat(a,".0").concat(e?"-0":""):i?">=".concat(n):">=".concat(n).concat(e?"-0":""),u=g(c)?"":g(l)?"<".concat(+c+1,".0.0-0"):g(p)?"<".concat(c,".").concat(+l+1,".0-0"):f?"<=".concat(c,".").concat(l,".").concat(p,"-").concat(f):e?"<".concat(c,".").concat(l,".").concat(+p+1,"-0"):"<=".concat(u),"".concat(n," ").concat(u).trim()}},P=function(e,t,n){for(var r=0;r<e.length;r++)if(!e[r].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(var a=0;a<e.length;a++)if(s(e[a].semver),e[a].semver!==i.ANY&&e[a].semver.prerelease.length>0){var o=e[a].semver;if(o.major===t.major&&o.minor===t.minor&&o.patch===t.patch)return!0}return!1}return!0}},function(e,t){e.exports=c},,function(e,t){e.exports=l},function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return c}));var r=n(1),a=n.n(r),o=n(13),i=n(7),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u=8;function c(e){var t;if(function(e){return!e.datasource&&!e.datasources&&!e.triggers&&(t=e.targets,!t||a.a.isArray(t)&&(0===t.length||1===t.length&&a.a.isEmpty(t[0])));var t}(e))return delete e.targets,e;var n=function(e){return e.schemaVersion||1}(e);if(n<2&&(e.datasources=[e.datasource],e.targets={},e.targets[e.datasources[0]]=e.triggers,delete e.triggers,delete e.datasource),n<3&&(delete e.lastChangeField,delete e.infoField,delete e.scroll,delete e.hideHostsInMaintenance),n<5&&e.targets&&!a.a.isEmpty(e.targets)&&a.a.each(e.targets,(function(e){var t;a.a.defaultsDeep(e,{group:{filter:""},host:{filter:""},application:{filter:""},trigger:{filter:""},tags:{filter:""},proxy:{filter:""},refId:Object(o.b)(t)})})),n<6&&e.showEvents&&"1"===e.showEvents.value&&(e.showEvents.value=1),n<7){var r=[];for(var i in e.targets){f(v=e.targets[i])||m(v,i)||r.push(s(s({},v),{datasource:i}))}for(var u=0,c=r;u<c.length;u++){(v=c[u]).refId||(v.refId=Object(o.b)(r))}e.targets=r,delete e.datasources}if(n<8){1===e.targets.length?e.targets[0].datasource&&(e.datasource=e.targets[0].datasource,delete e.targets[0].datasource):e.targets.length>1&&(e.datasource="-- Mixed --");for(var d=0,h=e.targets;d<h.length;d++){var v;(v=h[d]).queryType=5,v.showProblems=p(e),v.options=l(e),a.a.defaults(v.options,{hostsInMaintenance:!0}),a.a.defaults(v,{tags:{filter:""}})}e.sortProblems="priority"===(null===(t=e.sortTriggersBy)||void 0===t?void 0:t.value)?"priority":"lastchange",delete e.showEvents,delete e.showTriggers,delete e.hostsInMaintenance,delete e.sortTriggersBy}return e}function l(e){var t,n=2;"acknowledged"===e.showTriggers?n=1:"unacknowledged"===e.showTriggers&&(n=0);var r=1001;return e.limit&&100!==e.limit&&(r=e.limit),{hostsInMaintenance:e.hostsInMaintenance,sortProblems:"priority"===(null===(t=e.sortTriggersBy)||void 0===t?void 0:t.value)?"priority":"default",minSeverity:0,acknowledged:n,limit:r}}function p(e){var t,n,r,a;return 1===(null===(t=e.showEvents)||void 0===t?void 0:t.value)?i.a.Problems:0===(null===(n=e.showEvents)||void 0===n?void 0:n.value)||(null===(a=null===(r=e.showEvents)||void 0===r?void 0:r.value)||void 0===a?void 0:a.length)>1?i.a.History:i.a.Problems}function f(e){return!e||!(e.group&&e.host&&e.application&&e.trigger)}function m(e,t){return e&&"A"===e.refId&&"0"===t}},function(e,t,n){var r=n(25).MAX_SAFE_COMPONENT_LENGTH,a=n(26),o=(t=e.exports={}).re=[],i=t.src=[],s=t.t={},u=0,c=function(e,t,n){var r=u++;a(r,t),s[e]=r,i[r]=t,o[r]=new RegExp(t,n?"g":void 0)};c("NUMERICIDENTIFIER","0|[1-9]\\d*"),c("NUMERICIDENTIFIERLOOSE","[0-9]+"),c("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),c("MAINVERSION","(".concat(i[s.NUMERICIDENTIFIER],")\\.")+"(".concat(i[s.NUMERICIDENTIFIER],")\\.")+"(".concat(i[s.NUMERICIDENTIFIER],")")),c("MAINVERSIONLOOSE","(".concat(i[s.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(i[s.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(i[s.NUMERICIDENTIFIERLOOSE],")")),c("PRERELEASEIDENTIFIER","(?:".concat(i[s.NUMERICIDENTIFIER],"|").concat(i[s.NONNUMERICIDENTIFIER],")")),c("PRERELEASEIDENTIFIERLOOSE","(?:".concat(i[s.NUMERICIDENTIFIERLOOSE],"|").concat(i[s.NONNUMERICIDENTIFIER],")")),c("PRERELEASE","(?:-(".concat(i[s.PRERELEASEIDENTIFIER],"(?:\\.").concat(i[s.PRERELEASEIDENTIFIER],")*))")),c("PRERELEASELOOSE","(?:-?(".concat(i[s.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(i[s.PRERELEASEIDENTIFIERLOOSE],")*))")),c("BUILDIDENTIFIER","[0-9A-Za-z-]+"),c("BUILD","(?:\\+(".concat(i[s.BUILDIDENTIFIER],"(?:\\.").concat(i[s.BUILDIDENTIFIER],")*))")),c("FULLPLAIN","v?".concat(i[s.MAINVERSION]).concat(i[s.PRERELEASE],"?").concat(i[s.BUILD],"?")),c("FULL","^".concat(i[s.FULLPLAIN],"$")),c("LOOSEPLAIN","[v=\\s]*".concat(i[s.MAINVERSIONLOOSE]).concat(i[s.PRERELEASELOOSE],"?").concat(i[s.BUILD],"?")),c("LOOSE","^".concat(i[s.LOOSEPLAIN],"$")),c("GTLT","((?:<|>)?=?)"),c("XRANGEIDENTIFIERLOOSE","".concat(i[s.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),c("XRANGEIDENTIFIER","".concat(i[s.NUMERICIDENTIFIER],"|x|X|\\*")),c("XRANGEPLAIN","[v=\\s]*(".concat(i[s.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(i[s.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(i[s.XRANGEIDENTIFIER],")")+"(?:".concat(i[s.PRERELEASE],")?").concat(i[s.BUILD],"?")+")?)?"),c("XRANGEPLAINLOOSE","[v=\\s]*(".concat(i[s.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(i[s.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(i[s.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(i[s.PRERELEASELOOSE],")?").concat(i[s.BUILD],"?")+")?)?"),c("XRANGE","^".concat(i[s.GTLT],"\\s*").concat(i[s.XRANGEPLAIN],"$")),c("XRANGELOOSE","^".concat(i[s.GTLT],"\\s*").concat(i[s.XRANGEPLAINLOOSE],"$")),c("COERCE","".concat("(^|[^\\d])(\\d{1,").concat(r,"})")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:\\.(\\d{1,".concat(r,"}))?")+"(?:$|[^\\d])"),c("COERCERTL",i[s.COERCE],!0),c("LONETILDE","(?:~>?)"),c("TILDETRIM","(\\s*)".concat(i[s.LONETILDE],"\\s+"),!0),t.tildeTrimReplace="$1~",c("TILDE","^".concat(i[s.LONETILDE]).concat(i[s.XRANGEPLAIN],"$")),c("TILDELOOSE","^".concat(i[s.LONETILDE]).concat(i[s.XRANGEPLAINLOOSE],"$")),c("LONECARET","(?:\\^)"),c("CARETTRIM","(\\s*)".concat(i[s.LONECARET],"\\s+"),!0),t.caretTrimReplace="$1^",c("CARET","^".concat(i[s.LONECARET]).concat(i[s.XRANGEPLAIN],"$")),c("CARETLOOSE","^".concat(i[s.LONECARET]).concat(i[s.XRANGEPLAINLOOSE],"$")),c("COMPARATORLOOSE","^".concat(i[s.GTLT],"\\s*(").concat(i[s.LOOSEPLAIN],")$|^$")),c("COMPARATOR","^".concat(i[s.GTLT],"\\s*(").concat(i[s.FULLPLAIN],")$|^$")),c("COMPARATORTRIM","(\\s*)".concat(i[s.GTLT],"\\s*(").concat(i[s.LOOSEPLAIN],"|").concat(i[s.XRANGEPLAIN],")"),!0),t.comparatorTrimReplace="$1$2$3",c("HYPHENRANGE","^\\s*(".concat(i[s.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(i[s.XRANGEPLAIN],")")+"\\s*$"),c("HYPHENRANGELOOSE","^\\s*(".concat(i[s.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(i[s.XRANGEPLAINLOOSE],")")+"\\s*$"),c("STAR","(<|>)?=?\\s*\\*"),c("GTE0","^\\s*>=\\s*0.0.0\\s*$"),c("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(25).MAX_LENGTH,o=n(22),i=o.re,s=o.t,u=n(12);e.exports=function(e,t){if(t&&"object"===r(t)||(t={loose:!!t,includePrerelease:!1}),e instanceof u)return e;if("string"!=typeof e)return null;if(e.length>a)return null;if(!(t.loose?i[s.LOOSE]:i[s.FULL]).test(e))return null;try{return new u(e,t)}catch(e){return null}}},,function(e,t){var n=Number.MAX_SAFE_INTEGER||9007199254740991;e.exports={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:n,MAX_SAFE_COMPONENT_LENGTH:16}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r="object"===("undefined"==typeof process?"undefined":n(process))&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=console).error.apply(e,["SEMVER"].concat(n))}:function(){};e.exports=r},function(e,t,n){var r=n(16);e.exports=function(e,t,n){return r(e,t,n)>0}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var i=Symbol("SemVer ANY"),s=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"object"===r(n)||(n={loose:!!n,includePrerelease:!1}),t instanceof e){if(t.loose===!!n.loose)return t;t=t.value}f("comparator",t,n),this.options=n,this.loose=!!n.loose,this.parse(t),this.semver===i?this.value="":this.value=this.operator+this.semver.version,f("comp",this)}return o(e,null,[{key:"ANY",get:function(){return i}}]),o(e,[{key:"parse",value:function(e){var t=this.options.loose?c[l.COMPARATORLOOSE]:c[l.COMPARATOR],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: ".concat(e));this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new m(n[2],this.options.loose):this.semver=i}},{key:"toString",value:function(){return this.value}},{key:"test",value:function(e){if(f("Comparator.test",e,this.options.loose),this.semver===i||e===i)return!0;if("string"==typeof e)try{e=new m(e,this.options)}catch(e){return!1}return p(e,this.operator,this.semver,this.options)}},{key:"intersects",value:function(t,n){if(!(t instanceof e))throw new TypeError("a Comparator is required");if(n&&"object"===r(n)||(n={loose:!!n,includePrerelease:!1}),""===this.operator)return""===this.value||new d(t.value,n).test(this.value);if(""===t.operator)return""===t.value||new d(this.value,n).test(t.semver);var a=!(">="!==this.operator&&">"!==this.operator||">="!==t.operator&&">"!==t.operator),o=!("<="!==this.operator&&"<"!==this.operator||"<="!==t.operator&&"<"!==t.operator),i=this.semver.version===t.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==t.operator&&"<="!==t.operator),u=p(this.semver,"<",t.semver,n)&&(">="===this.operator||">"===this.operator)&&("<="===t.operator||"<"===t.operator),c=p(this.semver,">",t.semver,n)&&("<="===this.operator||"<"===this.operator)&&(">="===t.operator||">"===t.operator);return a||o||i&&s||u||c}}]),e}();e.exports=s;var u=n(22),c=u.re,l=u.t,p=n(41),f=n(26),m=n(12),d=n(17)},function(e,t,n){var r=n(17);e.exports=function(e,t,n){try{t=new r(t,n)}catch(e){return!1}return t.test(e)}},function(e,t){e.exports=p},function(e,t){var n=/^[0-9]+$/,r=function(e,t){var r=n.test(e),a=n.test(t);return r&&a&&(e=+e,t=+t),e===t?0:r&&!a?-1:a&&!r?1:e<t?-1:1};e.exports={compareIdentifiers:r,rcompareIdentifiers:function(e,t){return r(t,e)}}},function(e,t,n){var r=n(16);e.exports=function(e,t,n){return 0===r(e,t,n)}},function(e,t,n){var r=n(12);e.exports=function(e,t,n){var a=new r(e,n),o=new r(t,n);return a.compare(o)||a.compareBuild(o)}},function(e,t,n){var r=n(16);e.exports=function(e,t,n){return r(e,t,n)<0}},function(e,t,n){var r=n(16);e.exports=function(e,t,n){return r(e,t,n)>=0}},function(e,t,n){var r=n(16);e.exports=function(e,t,n){return r(e,t,n)<=0}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(12),o=n(28),i=o.ANY,s=n(17),u=n(29),c=n(27),l=n(34),p=n(36),f=n(35);e.exports=function(e,t,n,m){var d,h,v,g,y;switch(e=new a(e,m),t=new s(t,m),n){case">":d=c,h=p,v=l,g=">",y=">=";break;case"<":d=l,h=f,v=c,g="<",y="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(u(e,t,m))return!1;for(var b=function(n){var r=t.set[n],a=null,s=null;return r.forEach((function(e){e.semver===i&&(e=new o(">=0.0.0")),a=a||e,s=s||e,d(e.semver,a.semver,m)?a=e:v(e.semver,s.semver,m)&&(s=e)})),a.operator===g||a.operator===y?{v:!1}:s.operator&&s.operator!==g||!h(e,s.semver)?s.operator===y&&v(e,s.semver)?{v:!1}:void 0:{v:!1}},E=0;E<t.set.length;++E){var T=b(E);if("object"===r(T))return T.v}return!0}},function(e,t){e.exports=f},function(e,t){e.exports=m},function(e,t,n){var r=n(16);e.exports=function(e,t,n){return 0!==r(e,t,n)}},function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a=n(32),o=n(40),i=n(27),s=n(35),u=n(34),c=n(36);e.exports=function(e,t,n,l){switch(t){case"===":return"object"===r(e)&&(e=e.version),"object"===r(n)&&(n=n.version),e===n;case"!==":return"object"===r(e)&&(e=e.version),"object"===r(n)&&(n=n.version),e!==n;case"":case"=":case"==":return a(e,n,l);case"!=":return o(e,n,l);case">":return i(e,n,l);case">=":return s(e,n,l);case"<":return u(e,n,l);case"<=":return c(e,n,l);default:throw new TypeError("Invalid operator: ".concat(t))}}},,function(e,t){e.exports=d},function(e,t,n){var r=n(22);e.exports={re:r.re,src:r.src,tokens:r.t,SEMVER_SPEC_VERSION:n(25).SEMVER_SPEC_VERSION,SemVer:n(12),compareIdentifiers:n(31).compareIdentifiers,rcompareIdentifiers:n(31).rcompareIdentifiers,parse:n(23),valid:n(49),clean:n(50),inc:n(51),diff:n(52),major:n(53),minor:n(54),patch:n(55),prerelease:n(56),compare:n(16),rcompare:n(57),compareLoose:n(58),compareBuild:n(33),sort:n(59),rsort:n(60),gt:n(27),lt:n(34),eq:n(32),neq:n(40),gte:n(35),lte:n(36),cmp:n(41),coerce:n(61),Comparator:n(28),Range:n(17),satisfies:n(29),toComparators:n(62),maxSatisfying:n(63),minSatisfying:n(64),minVersion:n(65),validRange:n(66),outside:n(37),gtr:n(67),ltr:n(68),intersects:n(69),simplifyRange:n(70),subset:n(71)}},function(e,t){e.exports=h},,,,function(e,t,n){var r=n(23);e.exports=function(e,t){var n=r(e,t);return n?n.version:null}},function(e,t,n){var r=n(23);e.exports=function(e,t){var n=r(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null}},function(e,t,n){var r=n(12);e.exports=function(e,t,n,a){"string"==typeof n&&(a=n,n=void 0);try{return new r(e,n).inc(t,a).version}catch(e){return null}}},function(e,t,n){var r=n(23),a=n(32);e.exports=function(e,t){if(a(e,t))return null;var n=r(e),o=r(t),i=n.prerelease.length||o.prerelease.length,s=i?"pre":"",u=i?"prerelease":"";for(var c in n)if(("major"===c||"minor"===c||"patch"===c)&&n[c]!==o[c])return s+c;return u}},function(e,t,n){var r=n(12);e.exports=function(e,t){return new r(e,t).major}},function(e,t,n){var r=n(12);e.exports=function(e,t){return new r(e,t).minor}},function(e,t,n){var r=n(12);e.exports=function(e,t){return new r(e,t).patch}},function(e,t,n){var r=n(23);e.exports=function(e,t){var n=r(e,t);return n&&n.prerelease.length?n.prerelease:null}},function(e,t,n){var r=n(16);e.exports=function(e,t,n){return r(t,e,n)}},function(e,t,n){var r=n(16);e.exports=function(e,t){return r(e,t,!0)}},function(e,t,n){var r=n(33);e.exports=function(e,t){return e.sort((function(e,n){return r(e,n,t)}))}},function(e,t,n){var r=n(33);e.exports=function(e,t){return e.sort((function(e,n){return r(n,e,t)}))}},function(e,t,n){var r=n(12),a=n(23),o=n(22),i=o.re,s=o.t;e.exports=function(e,t){if(e instanceof r)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;var n=null;if((t=t||{}).rtl){for(var o;(o=i[s.COERCERTL].exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&o.index+o[0].length===n.index+n[0].length||(n=o),i[s.COERCERTL].lastIndex=o.index+o[1].length+o[2].length;i[s.COERCERTL].lastIndex=-1}else n=e.match(i[s.COERCE]);return null===n?null:a("".concat(n[2],".").concat(n[3]||"0",".").concat(n[4]||"0"),t)}},function(e,t,n){var r=n(17);e.exports=function(e,t){return new r(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))}},function(e,t,n){var r=n(12),a=n(17);e.exports=function(e,t,n){var o=null,i=null,s=null;try{s=new a(t,n)}catch(e){return null}return e.forEach((function(e){s.test(e)&&(o&&-1!==i.compare(e)||(i=new r(o=e,n)))})),o}},function(e,t,n){var r=n(12),a=n(17);e.exports=function(e,t,n){var o=null,i=null,s=null;try{s=new a(t,n)}catch(e){return null}return e.forEach((function(e){s.test(e)&&(o&&1!==i.compare(e)||(i=new r(o=e,n)))})),o}},function(e,t,n){var r=n(12),a=n(17),o=n(27);e.exports=function(e,t){e=new a(e,t);var n=new r("0.0.0");if(e.test(n))return n;if(n=new r("0.0.0-0"),e.test(n))return n;n=null;for(var i=0;i<e.set.length;++i){e.set[i].forEach((function(e){var t=new r(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":n&&!o(n,t)||(n=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: ".concat(e.operator))}}))}return n&&e.test(n)?n:null}},function(e,t,n){var r=n(17);e.exports=function(e,t){try{return new r(e,t).range||"*"}catch(e){return null}}},function(e,t,n){var r=n(37);e.exports=function(e,t,n){return r(e,t,">",n)}},function(e,t,n){var r=n(37);e.exports=function(e,t,n){return r(e,t,"<",n)}},function(e,t,n){var r=n(17);e.exports=function(e,t,n){return e=new r(e,n),t=new r(t,n),e.intersects(t)}},function(e,t,n){function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||a(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var i=n(29),s=n(16);e.exports=function(e,t,n){var o,u=[],c=null,l=null,p=e.sort((function(e,t){return s(e,t,n)})),f=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw i}}}}(p);try{for(f.s();!(o=f.n()).done;){var m=o.value;i(m,t,n)?(l=m,c||(c=m)):(l&&u.push([c,l]),l=null,c=null)}}catch(e){f.e(e)}finally{f.f()}c&&u.push([c,null]);for(var d=[],h=0,v=u;h<v.length;h++){var g=r(v[h],2),y=g[0],b=g[1];y===b?d.push(y):b||y!==p[0]?b?y===p[0]?d.push("<=".concat(b)):d.push("".concat(y," - ").concat(b)):d.push(">=".concat(y)):d.push("*")}var E=d.join(" || "),T="string"==typeof t.raw?t.raw:String(t);return E.length<T.length?E:t}},function(e,t,n){function r(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,u=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var o=n(17),i=n(28).ANY,s=n(29),u=n(16),c=function(e,t,n){if(1===e.length&&e[0].semver===i)return 1===t.length&&t[0].semver===i;var a,o,c,f,m=new Set,d=r(e);try{for(d.s();!(c=d.n()).done;){var h=c.value;">"===h.operator||">="===h.operator?a=l(a,h,n):"<"===h.operator||"<="===h.operator?o=p(o,h,n):m.add(h.semver)}}catch(e){d.e(e)}finally{d.f()}if(m.size>1)return null;if(a&&o){if((f=u(a.semver,o.semver,n))>0)return null;if(0===f&&(">="!==a.operator||"<="!==o.operator))return null}var v,g,y,b=r(m);try{for(b.s();!(v=b.n()).done;){var E=v.value;if(a&&!s(E,String(a),n))return null;if(o&&!s(E,String(o),n))return null;var T,x=r(t);try{for(x.s();!(T=x.n()).done;){var I=T.value;if(!s(E,String(I),n))return!1}}catch(e){x.e(e)}finally{x.f()}return!0}}catch(e){b.e(e)}finally{b.f()}var S,w=r(t);try{for(w.s();!(S=w.n()).done;){var A=S.value;if(y=y||">"===A.operator||">="===A.operator,g=g||"<"===A.operator||"<="===A.operator,a)if(">"===A.operator||">="===A.operator){if(l(a,A,n)===A)return!1}else if(">="===a.operator&&!s(a.semver,String(A),n))return!1;if(o)if("<"===A.operator||"<="===A.operator){if(p(o,A,n)===A)return!1}else if("<="===o.operator&&!s(o.semver,String(A),n))return!1;if(!A.operator&&(o||a)&&0!==f)return!1}}catch(e){w.e(e)}finally{w.f()}return!(a&&g&&!o&&0!==f)&&!(o&&y&&!a&&0!==f)},l=function(e,t,n){if(!e)return t;var r=u(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},p=function(e,t,n){if(!e)return t;var r=u(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};e.exports=function(e,t,n){e=new o(e,n),t=new o(t,n);var a,i=!1,s=r(e.set);try{e:for(s.s();!(a=s.n()).done;){var u,l=a.value,p=r(t.set);try{for(p.s();!(u=p.n()).done;){var f=u.value,m=c(l,f,n);if(i=i||null!==m,m)continue e}}catch(e){p.e(e)}finally{p.f()}if(i)return!1}}catch(e){s.e(e)}finally{s.f()}return!0}},,,,function(e,t,n){"use strict";on.$inject=["$compile","templateSrv"],n.r(t);var r=n(11),a=n(10),o=n(1),i=n.n(o),s=n(43),u=n.n(s),c=n(38),l=n(14),p=n(3),f=n(4);function m(e){return e.resultFormat=e.resultFormat||"time_series",function(e){return(!e.mode||0===e.mode||2===e.mode)&&!(!(e.hostFilter||e.itemFilter||e.downsampleFunction||e.host&&e.host.host)||void 0!==e.item.filter||void 0!==e.host.filter)}(e=function(e){e.group&&Array.isArray(e.group)&&(e.group={filter:""});return e}(e))?function(e){return e.group.filter="*"===e.group.name?"/.*/":e.group.name,e.host.filter="*"===e.host.name?d(e.hostFilter):e.host.name,e.application.filter="*"===e.application.name?"":e.application.name,e.item.filter="All"===e.item.name?d(e.itemFilter):e.item.name,e}(e):(function(e){if(e.functions)for(var t=0,n=e.functions;t<n.length;t++){var r=n[t];r.def&&"percentil"===r.def.name&&(r.def.name="percentile")}}(e),function(e){void 0===e.queryType&&("Metrics"===e.mode?e.queryType=f.f:void 0!==e.mode&&(e.queryType=e.mode,delete e.mode))}(e),function(e){e.queryType!==f.e||e.slaInterval||(e.slaInterval="none")}(e),function(e){var t;"priority"===(null===(t=e.options)||void 0===t?void 0:t.sortProblems)&&(e.options.sortProblems="severity")}(e),e)}function d(e){return e?"/"+e+"/":"/.*/"}function h(e){if(e||(e={}),!function(e){if(e.dbConnection&&!i.a.isEmpty(e.dbConnection))return!0;if(e.schema&&2!==e.schema)return!0;return!1}(e))return e;var t=e.schema||1;if(e.schema=2,t<2){var n=e.dbConnection||{};e.dbConnectionEnable=n.enable||!1,e.dbConnectionDatasourceId=n.datasourceId||null,delete e.dbConnection}return e}var v=[],g={Transform:[],Aggregate:[],Filter:[],Trends:[],Time:[],Alias:[],Special:[]};function y(e){e.params=e.params||[],e.defaultParams=e.defaultParams||[],e.category&&g[e.category].push(e),v[e.name]=e,v[e.shortName||e.name]=e}y({name:"groupBy",category:"Transform",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median"]}],defaultParams:["1m","avg"]}),y({name:"scale",category:"Transform",params:[{name:"factor",type:"float",options:[100,.01,10,-1]}],defaultParams:[100]}),y({name:"offset",category:"Transform",params:[{name:"delta",type:"float",options:[-100,100]}],defaultParams:[100]}),y({name:"delta",category:"Transform",params:[],defaultParams:[]}),y({name:"rate",category:"Transform",params:[],defaultParams:[]}),y({name:"movingAverage",category:"Transform",params:[{name:"factor",type:"int",options:[6,10,60,100,600]}],defaultParams:[10]}),y({name:"exponentialMovingAverage",category:"Transform",params:[{name:"smoothing",type:"float",options:[6,10,60,100,600]}],defaultParams:[.2]}),y({name:"percentile",category:"Transform",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),y({name:"removeAboveValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),y({name:"removeBelowValue",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),y({name:"transformNull",category:"Transform",params:[{name:"number",type:"float"}],defaultParams:[0]}),y({name:"sumSeries",category:"Aggregate",params:[],defaultParams:[]}),y({name:"median",category:"Aggregate",params:[{name:"interval",type:"string"}],defaultParams:["1m"]}),y({name:"average",category:"Aggregate",params:[{name:"interval",type:"string"}],defaultParams:["1m"]}),y({name:"percentileAgg",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"percent",type:"float",options:[25,50,75,90,95,99,99.9]}],defaultParams:["1m",95]}),y({name:"min",category:"Aggregate",params:[{name:"interval",type:"string"}],defaultParams:["1m"]}),y({name:"max",category:"Aggregate",params:[{name:"interval",type:"string"}],defaultParams:["1m"]}),y({name:"sum",category:"Aggregate",params:[{name:"interval",type:"string"}],defaultParams:["1m"]}),y({name:"count",category:"Aggregate",params:[{name:"interval",type:"string"}],defaultParams:["1m"]}),y({name:"aggregateBy",category:"Aggregate",params:[{name:"interval",type:"string"},{name:"function",type:"string",options:["avg","min","max","sum","count","median"]}],defaultParams:["1m","avg"]}),y({name:"top",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median"]}],defaultParams:[5,"avg"]}),y({name:"bottom",category:"Filter",params:[{name:"number",type:"int"},{name:"value",type:"string",options:["avg","min","max","sum","count","median"]}],defaultParams:[5,"avg"]}),y({name:"sortSeries",category:"Filter",params:[{name:"direction",type:"string",options:["asc","desc"]}],defaultParams:["asc"]}),y({name:"trendValue",category:"Trends",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),y({name:"timeShift",category:"Time",params:[{name:"interval",type:"string",options:["24h","7d","1M","+24h","-24h"]}],defaultParams:["24h"]}),y({name:"setAlias",category:"Alias",params:[{name:"alias",type:"string"}],defaultParams:[]}),y({name:"setAliasByRegex",category:"Alias",params:[{name:"aliasByRegex",type:"string"}],defaultParams:[]}),y({name:"replaceAlias",category:"Alias",params:[{name:"regexp",type:"string"},{name:"newAlias",type:"string"}],defaultParams:["/(.*)/","$1"]}),y({name:"consolidateBy",category:"Special",params:[{name:"type",type:"string",options:["avg","min","max","sum","count"]}],defaultParams:["avg"]}),i.a.each(g,(function(e,t){g[t]=i.a.sortBy(e,"name")}));var b=function(){function e(e,t){this.def=e,t?this.params=t:(this.params=[],this.params=e.defaultParams.slice(0)),this.updateText()}return e.prototype.bindFunction=function(e){var t=e[this.def.name];if(t){for(var n=t,r=void 0,a=0;a<this.params.length;a++)r=this.params[a],"int"!==this.def.params[a].type&&"float"!==this.def.params[a].type||(r=Number(r)),n=i.a.partial(n,r);return n}throw{message:"Method not found "+this.def.name}},e.prototype.render=function(e){var t=this,n=this.def.name+"(",r=i.a.map(this.params,(function(e,n){var r=t.def.params[n].type;return"int"===r||"float"===r||"value_or_series"===r||"boolean"===r||"int_or_interval"===r&&Object(p.j)(e)?e:"'"+e+"'"}));return e&&r.unshift(e),n+r.join(", ")+")"},e.prototype._hasMultipleParamsInString=function(e,t){return-1!==e.indexOf(",")&&(this.def.params[t+1]&&this.def.params[t+1].optional)},e.prototype.updateParam=function(e,t){var n=this;this._hasMultipleParamsInString(e,t)?i.a.each(e.split(","),(function(e,t){n.updateParam(e.trim(),t)})):(""===e&&this.def.params[t].optional?this.params.splice(t,1):this.params[t]=e,this.updateText())},e.prototype.updateText=function(){if(0!==this.params.length){var e=this.def.name+"(";e+=this.params.join(", "),e+=")",this.text=e}else this.text=this.def.name+"()"},e}();function E(e,t){if(i.a.isString(e)){if(!v[e])throw{message:"Method not found "+name};e=v[e]}return new b(e,t)}function T(){return g}function x(e,t,n){if(0===e.length)return[];if(t===f.j)return I(e,n);for(var r,a,o=p.n(t),i=[],s=[],u=e.length?w(e[0][1],o):0,c=u,l=0;l<e.length;l++)if((c=w((a=e[l])[1],o))===u)s.push(a[0]);else if(c>u){for(r=n(s),i.push([r,u]),u+=o;u<c;)i.push([null,u]),u+=o;s=[a[0]]}return r=n(s),i.push([r,u]),i}function I(e,t){for(var n,r=[],a=e[0][1],o=e[e.length-1][1],i=0;i<e.length;i++)n=e[i],r.push(n[0]);var s=t(r);return[[s,a],[s,o]]}function S(e){for(var t=null,n=0;n<e.length;n++)null!==e[n]&&(t+=e[n]);return t}function w(e,t){return Math.floor(e/t)*t}function A(e){return i.a.sortBy(e,(function(e){return e[1]}))}function P(e){for(var t,n,r=e.length-1;r>=0;r--)e[r][0]||(t=D(e,r),n=R(e,r),t||(t=n),n||(n=t),e[r][0]=O(e[r][1],t,n));return e}function O(e,t,n){return t[1]===n[1]?(t[0]+n[0])/2:t[0]+(n[0]-t[0])/(n[1]-t[1])*(e-t[1])}function R(e,t){for(var n=t;n<e.length;n++)if(null!==e[n][0])return e[n];return null}function D(e,t){for(var n=t;n>0;n--)if(null!==e[n][0])return e[n];return null}var C={downsample:function(e,t,n,r){for(var a=[],o={from:1e3*t-n,to:1e3*t},s=0,u=0,c=0,l=[],p=e.length-1;p>=0;p-=1)o.from<e[p][1]&&e[p][1]<=o.to?(s+=e[p][0],u++,l.push(e[p][0])):(c=u?s/u:0,"max"===r?a.push([i.a.max(l),o.to]):"min"===r?a.push([i.a.min(l),o.to]):a.push([c,o.to]),o.to=o.from,o.from-=n,s=0,u=0,l=[],p++);return a.reverse()},groupBy:function(e,t,n){var r=p.n(t),a=i.a.groupBy(e,(function(e){return Math.floor(e[1]/r)*r})),o=i.a.mapValues(a,(function(e){var t=i.a.map(e,(function(e){return e[0]}));return n(t)}));return A(i.a.map(o,(function(e,t){return[Number(e),Number(t)]})))},groupBy_perf:x,groupByRange:I,sumSeries:function(e){var t=i.a.uniq(i.a.map(i.a.flatten(e),(function(e){return e[1]})));t=i.a.sortBy(t);var n=i.a.map(e,(function(e){e=function(e,t){for(var n,r=[],a=[],o=0;o<t.length;o++)t[o]<e[0][1]?(n=[0,t[o]],r.push(n)):t[o]>e[e.length-1][1]&&(n=[0,t[o]],a.push(n));return i.a.concat(i.a.concat(r,e),a)}(e,t);var n=i.a.map(e,(function(e){return e[1]})),r=i.a.map(i.a.difference(t,n),(function(e){return[null,e]}));return A(e.concat(r))}));i.a.each(n,P);for(var r,a=[],o=t.length-1;o>=0;o--){r=0;for(var s=n.length-1;s>=0;s--)r+=n[s][o][0];a.push([r,t[o]])}return A(a)},scale:function(e,t){return i.a.map(e,(function(e){return[e[0]*t,e[1]]}))},offset:function(e,t){for(var n=0;n<e.length;n++)e[n]=[e[n][0]+t,e[n][1]];return e},scale_perf:function(e,t){for(var n=0;n<e.length;n++)e[n]=[e[n][0]*t,e[n][1]];return e},delta:function(e){for(var t,n=[],r=1;r<e.length;r++)t=e[r][0]-e[r-1][0],n.push([t,e[r][1]]);return n},rate:function(e){for(var t,n,r=[],a=0,o=0,i=1;i<e.length;i++)t=e[i],n=e[i-1],o=(t[1]-n[1])/1e3,t[0]>=n[0]&&(a=(t[0]-n[0])/o),r.push([a,t[1]]);return r},simpleMovingAverage:function(e,t){for(var n,r=[],a=null,o=0,i=t;i>0;i--)null!==e[t-i][0]&&(a+=e[t-i][0],o++);o>0?a/=o:a=null,r.push([a,e[t-1][1]]);for(var s=t;s<e.length;s++)null!==e[s][0]&&(a=((n=a*o)+e[s][0])/(o+1),o++),null!==e[s-t][0]&&(n=a*o,o>1?(a=(n-e[s-t][0])/(o-1),o--):(a=null,o=0)),r.push([a,e[s][1]]);return r},expMovingAverage:function(e,t){var n,r,a=[e[0]],o=e[0][0];if(t>1){r=2/(t+1);for(var i=null,s=0,u=t;u>0;u--)null!==e[t-u][0]&&(i+=e[t-u][0],s++);s>0&&(a=[[i/=s,e[0][1]]],o=i,t=1)}else r=t,t=1;for(var c=t;c<e.length;c++)null!==e[c][0]?(o=n=r*e[c][0]+(1-r)*o,a.push([n,e[c][1]])):a.push([null,e[c][1]]);return a},SUM:S,COUNT:function(e){return e.length},AVERAGE:function(e){var t=function(e){for(var t=[],n=0;n<e.length;n++)null!==e[n]&&t.push(e[n]);return t}(e);return 0===t.length?null:S(t)/t.length},MIN:function(e){return i.a.min(e)},MAX:function(e){return i.a.max(e)},MEDIAN:function(e){var t=i.a.sortBy(e);return t[Math.floor(t.length/2)]},PERCENTILE:function(e,t){var n=i.a.sortBy(t);return n[Math.floor(n.length*e/100)]},sortByTime:A,flattenDatapoints:function(e){return p.h(e)<=2?e:i.a.flatten(e)}},N=C.SUM,_=C.COUNT,k=C.AVERAGE,L=C.MIN,M=C.MAX,j=C.MEDIAN,F=C.PERCENTILE,q=C.downsample,B=C.sumSeries;function V(e,t,n,r){var a=z[n],o=i.a.sortBy(r,(function(e){var t=i.a.map(e.datapoints,(function(e){return e[0]}));return a(t)}));return"bottom"===e?o.slice(0,t):o.slice(-t)}function H(e,t,n){var r=C.flattenDatapoints(n);return x(C.sortByTime(r),t,e)}var G={groupBy:function(e,t,n){return x(n,e,z[t])},scale:function(e,t){return C.scale_perf(t,e)},offset:function(e,t){return C.offset(t,e)},delta:C.delta,rate:C.rate,movingAverage:function(e,t){return C.simpleMovingAverage(t,e)},exponentialMovingAverage:function(e,t){return C.expMovingAverage(t,e)},percentile:function(e,t,n){return x(n,e,i.a.partial(F,t))},transformNull:function(e,t){return i.a.map(t,(function(t){return[null!==t[0]?t[0]:e,t[1]]}))},aggregateBy:function(e,t,n){var r=C.flattenDatapoints(n);return x(C.sortByTime(r),e,z[t])},percentileAgg:function(e,t,n){var r=C.flattenDatapoints(n);return x(C.sortByTime(r),e,i.a.partial(F,t))},average:i.a.partial(H,k),min:i.a.partial(H,L),max:i.a.partial(H,M),median:i.a.partial(H,j),sum:i.a.partial(H,N),count:i.a.partial(H,_),sumSeries:B,removeAboveValue:function(e,t){return i.a.map(t,(function(t){return[t[0]>e?null:t[0],t[1]]}))},removeBelowValue:function(e,t){return i.a.map(t,(function(t){return[t[0]<e?null:t[0],t[1]]}))},top:i.a.partial(V,"top"),bottom:i.a.partial(V,"bottom"),sortSeries:function(e,t){return i.a.orderBy(t,[function(e){return e.target.toLowerCase()}],e)},timeShift:function(e,t){var n=p.q(e)/1e3;return i.a.map(t,(function(e){return e-n}))},setAlias:function(e,t){return this.templateSrv&&t&&t.scopedVars&&(e=this.templateSrv.replace(e,t.scopedVars)),t.target=e,t},setAliasByRegex:function(e,t){var n;return t.target=(n=t.target,new RegExp(e).exec(n)[0]),t},replaceAlias:function(e,t,n){var r;r=p.k(e)?p.a(e):e;var a=n.target.replace(r,t);return this.templateSrv&&n&&n.scopedVars&&(a=this.templateSrv.replace(a,n.scopedVars)),n.target=a,n}},z={avg:k,min:L,max:M,median:j,sum:N,count:_},U={downsampleSeries:q,groupBy:function(e,t,n){return x(n,e,t)},AVERAGE:k,MIN:L,MAX:M,MEDIAN:j,SUM:N,COUNT:_,unShiftTimeSeries:function(e,t){var n=p.q(e);return i.a.map(t,(function(e){return[e[0],e[1]+n]}))},get aggregationFunctions(){return z},get metricFunctions(){return G}},Q=n(39),$=n.n(Q),X=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r};function W(e,t,n,r){var a=i.a.groupBy(e,"itemid"),o=i.a.uniqBy(i.a.flatten(i.a.map(t,"hosts")),"hostid");return i.a.map(a,(function(e,a){var s=i.a.find(t,{itemid:a}),u=s.name,c={__zbx_item:{value:s.name},__zbx_item_name:{value:s.name},__zbx_item_key:{value:s.key_}};if(i.a.keys(o).length>0){var l=i.a.find(o,{hostid:s.hostid});c.__zbx_host={value:l.host},c.__zbx_host_name={value:l.name},i.a.keys(o).length>1&&n&&(u=l.name+": "+u)}return{target:u,datapoints:i.a.map(e,r),scopedVars:c}}))}function Y(e,t){var n=t.value;return e.textFilter&&(n=Z(t.value,e.textFilter,e.useCaptureGroups)),[n,1e3*t.clock+Math.round(t.ns/1e6)]}function Z(e,t,n){var r=new RegExp(t).exec(e);return r?n?r[1]:r[0]:""}function J(e){return[Number(e.value),1e3*e.clock+Math.round(e.ns/1e6)]}function K(e,t){var n;switch(e){case"min":n=t.value_min;break;case"max":n=t.value_max;break;case"avg":n=t.value_avg;break;case"sum":n=t.value_sum;break;case"count":n=t.value_count;break;default:n=t.value_avg}return[Number(n),1e3*t.clock]}var ee={handleHistory:function(e,t,n){return void 0===n&&(n=!0),W(e,t,n,J)},convertHistory:W,handleTrends:function(e,t,n,r){return void 0===r&&(r=!0),W(e,t,r,i.a.partial(K,n))},handleText:function(e,t,n,r){return void 0===r&&(r=!0),W(e,t,r,i.a.partial(Y,n))},handleHistoryAsTable:function(e,t,n){var r=new $.a;r.addColumn({text:"Host"}),r.addColumn({text:"Item"}),r.addColumn({text:"Key"}),r.addColumn({text:"Last value"});var a=i.a.groupBy(e,"itemid");return i.a.each(t,(function(e){var t=a[e.itemid]||[],o=i.a.last(t),s=o?o.value:null;if(!n.options.skipEmptyValues||s&&""!==s){n.textFilter&&(s=Z(s,n.textFilter,n.useCaptureGroups));var u=i.a.first(e.hosts);u=u?u.name:"",r.rows.push([u,e.name,e.key_,s])}})),r},handleSLAResponse:function(e,t,n){var r=n[e.serviceid].sla;if("status"===t.property){var a=parseInt(n[e.serviceid].status,10);return{target:e.name+" "+t.name,datapoints:[[a,1e3*r[0].to]]}}var o=void 0,i=[];for(o=0;o<r.length;o++)0===o&&i.push([r[o][t.property],1e3*r[o].from]),i.push([r[o][t.property],1e3*r[o].to]);return{target:e.name+" "+t.name,datapoints:i}},handleTriggersResponse:function(e,t,n){if(i.a.isArray(e)){var r=function(e){var t=i.a.uniq(i.a.flattenDeep(i.a.map(e,(function(e){return i.a.map(e.groups,"name")})))),n={};return i.a.each(t,(function(e){n[e]={0:0,1:0,2:0,3:0,4:0,5:0}})),i.a.each(e,(function(e){i.a.each(e.groups,(function(t){n[t.name][e.priority]++}))})),n}(e),a=i.a.map(t,"name"),o=new $.a;return o.addColumn({text:"Host group"}),i.a.each(i.a.orderBy(f.k,["val"],["desc"]),(function(e){o.addColumn({text:e.text})})),i.a.each(r,(function(e,t){if(i.a.includes(a,t)){var n=i.a.map(i.a.orderBy(i.a.toPairs(e),(function(e){return e[0]}),["desc"]),(function(e){return e[1]}));n=i.a.concat.apply(i.a,X([[t]],n)),o.rows.push(n)}})),o}var s=null;try{s=Number(e)}catch(e){console.log("Error when handling triggers count: ",e)}return{target:"triggers count",datapoints:[[s,1e3*n[1]]]}},sortTimeseries:function(e){return i.a.forEach(e,(function(e){e.datapoints=i.a.sortBy(e.datapoints,(function(e){return e[f.a]}))})),e}};function te(e,t){for(var n=[],r=0;r<e.length;r++){var a=e[r],o=t[Number(a.objectid)];if(o){var i={timestamp:Number(a.clock),triggerid:a.objectid,eventid:a.eventid,name:a.name,severity:a.severity,acknowledged:a.acknowledged,acknowledges:a.acknowledges,tags:a.tags,suppressed:a.suppressed,suppression_data:a.suppression_data,description:o.description,comments:o.comments,value:o.value,groups:o.groups,hosts:o.hosts,items:o.items,alerts:o.alerts,url:o.url,expression:o.expression,correlation_mode:o.correlation_mode,correlation_tag:o.correlation_tag,manual_close:o.manual_close,state:o.state,error:o.error};n.push(i)}}return n}function ne(e,t,n){for(var r=n.valueFromEvent,a=[],o=0;o<e.length;o++){var i=e[o],s=t[Number(i.objectid)];if(s){var u={value:r?i.value:s.value,timestamp:Number(i.clock),triggerid:i.objectid,eventid:i.eventid,name:i.name,severity:i.severity,acknowledged:i.acknowledged,acknowledges:i.acknowledges,tags:i.tags,suppressed:i.suppressed,description:s.description,comments:s.comments,groups:s.groups,hosts:s.hosts,items:s.items,alerts:s.alerts,url:s.url,expression:s.expression,correlation_mode:s.correlation_mode,correlation_tag:s.correlation_tag,manual_close:s.manual_close,state:s.state,error:s.error};a.push(u)}}return a}var re={addTriggerDataSource:function(e,t){return i.a.each(e,(function(e){e.datasource=t.datasource})),e},addTriggerHostProxy:function(e,t){return e.forEach((function(e){if(e.hosts&&e.hosts.length){var n=e.hosts[0];if("0"!==n.proxy_hostid){var r=t[n.proxy_hostid];n.proxy=r?r.host:""}}})),e},setMaintenanceStatus:function(e){return i.a.each(e,(function(e){var t=i.a.some(e.hosts,(function(e){return"1"===e.maintenance_status}));e.maintenance=t})),e},setAckButtonStatus:function(e,t){return i.a.each(e,(function(e){e.showAckButton=t})),e},filterTriggersPre:function(e,t){var n=t.trigger.filter;return n&&(e=function(e,t){return p.k(t)?i.a.filter(e,(function(e){return p.a(t).test(e.description)})):i.a.filter(e,(function(e){return e.description===t}))}(e,n)),t.options.hostsInMaintenance||(e=i.a.filter(e,(function(e){return!e.maintenance}))),e},sortProblems:function(e,t){var n,r;return"severity"===(null===(n=t.options)||void 0===n?void 0:n.sortProblems)?e=i.a.orderBy(e,["severity","eventid"],["desc","desc"]):"lastchange"===(null===(r=t.options)||void 0===r?void 0:r.sortProblems)&&(e=i.a.orderBy(e,["timestamp","eventid"],["desc","desc"])),e},toDataFrame:function(e){return{name:"problems",fields:[{name:"Problems",type:r.FieldType.other,values:new r.ArrayVector(e),config:{}}],length:e.length}},joinTriggersWithProblems:te,joinTriggersWithEvents:ne},ae=n(9),oe=n.n(ae),ie=function(){function e(e){this.cacheEnabled=e.enabled,this.ttl=e.ttl||6e5,this.cache={},this.promises={}}return e.prototype.cacheRequest=function(e,t,n){return function(e,t,n,r){return function(){r.cache[t]||(r.cache[t]={});var a=r.cache[t],o=se(arguments);return r.cacheEnabled&&!r._isExpired(a[o])?Promise.resolve(a[o].value):e.apply(n,arguments).then((function(e){return void 0!==e&&(a[o]={value:e,timestamp:Date.now()}),e}))}}(e,t,n,this)},e.prototype.proxify=function(e,t,n){return this.promises[t]||(this.promises[t]={}),function(e,t,n){return function(){var r=se(arguments);return t[r]||(t[r]=Promise.resolve(e.apply(n,arguments).then((function(e){return t[r]=null,e})).catch((function(e){throw t[r]=null,e})))),t[r]}}(e,this.promises[t],n)},e.prototype.proxifyWithCache=function(e,t,n){var r=this.proxify(e,t,n);return this.cacheRequest(r,t,n)},e.prototype._isExpired=function(e){if(e){var t=Date.now()-e.timestamp;return!(e.timestamp&&t<this.ttl)}return!0},e}();function se(e){return function(e){var t,n,r,a=0;if(0!==e.length)for(t=0,r=e.length;t<r;t++)n=e.charCodeAt(t),a=(a<<5)-a+n,a|=0;return a}(JSON.stringify(e))}function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t,n){return t&&ce(e.prototype,t),n&&ce(e,n),e}var pe={0:"history",1:"history_str",2:"history_log",3:"history_uint",4:"history_text"},fe={0:"trends",3:"trends_uint"},me={avg:"value_avg",min:"value_min",max:"value_max",sum:"num*value_avg"},de=function(){function e(t){ue(this,e),this.datasourceId=t.datasourceId,this.datasourceName=t.datasourceName,this.datasourceTypeId=null,this.datasourceTypeName=null}return le(e,[{key:"loadDBDataSource",value:function(){var t=this;return e.loadDatasource(this.datasourceId,this.datasourceName).then((function(e){return t.datasourceTypeId=e.meta.id,t.datasourceTypeName=e.meta.name,t.datasourceName||(t.datasourceName=e.name),t.datasourceId||(t.datasourceId=e.id),e}))}},{key:"testDataSource",value:function(){throw new he("testDataSource()")}},{key:"getHistory",value:function(){throw new he("getHistory()")}},{key:"getTrends",value:function(){throw new he("getTrends()")}},{key:"handleGrafanaTSResponse",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ve(e,t,n)}}],[{key:"loadDatasource",value:function(e,t){if(!t&&void 0!==e){var n=i.a.find(Object(a.getDataSourceSrv)().getAll(),{id:e});if(!n)return Promise.reject("Data Source with ID ".concat(e," not found"));t=n.name}return t?Object(a.getDataSourceSrv)().loadDatasource(t):Promise.reject("Data Source name should be specified")}}]),e}(),he=function(){function e(t){ue(this,e),this.code=null,this.name="ZabbixNotImplemented",this.message="Zabbix DB Connector Error: method ".concat(t||""," should be implemented in subclass of DBConnector")}return le(e,[{key:"toString",value:function(){return this.message}}]),e}();function ve(e,t,n){var r=i.a.uniqBy(i.a.flatten(i.a.map(t,"hosts")),"hostid"),a=i.a.map(i.a.compact(e),(function(e){var a=e.name,o=i.a.find(t,{itemid:a}),s=o.name,u={__zbx_item:{value:o.name},__zbx_item_name:{value:o.name},__zbx_item_key:{value:o.key_}};if(i.a.keys(r).length>0){var c=i.a.find(r,{hostid:o.hostid});u.__zbx_host={value:c.host},u.__zbx_host_name={value:c.name},i.a.keys(r).length>1&&n&&(s=c.name+": "+s)}return{target:s,datapoints:i.a.cloneDeep(e.points),scopedVars:u}}));return i.a.sortBy(a,"target")}var ge={DBConnector:de,DEFAULT_QUERY_LIMIT:1e4,HISTORY_TO_TABLE_MAP:pe,TREND_TO_TABLE_MAP:fe,consolidateByFunc:{avg:"AVG",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"},consolidateByTrendColumns:me},ye=n(44),be=n.n(ye),Ee=n(20),Te=n.n(Ee),xe=n(7),Ie=function(){function e(e,t,n){this.datasourceId=n,this.backendAPIUrl="/api/datasources/"+this.datasourceId+"/resources/zabbix-api",this.requestOptions={basicAuth:e,withCredentials:t},this.getTrend=this.getTrend_ZBXNEXT1193,this.initVersion()}return e.prototype.request=function(e,t){return this.backendAPIRequest(e,t).then((function(e){var t;return null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.result}))},e.prototype.backendAPIRequest=function(e,t){void 0===t&&(t={});var n={url:this.backendAPIUrl,method:"POST",headers:{"Content-Type":"application/json"},data:{datasourceId:this.datasourceId,method:e,params:t}};return(this.requestOptions.basicAuth||this.requestOptions.withCredentials)&&(n.withCredentials=!0),this.requestOptions.basicAuth&&(n.headers.Authorization=this.requestOptions.basicAuth),Object(a.getBackendSrv)().datasourceRequest(n)},e.prototype.getVersion=function(){return this.request("apiinfo.version")},e.prototype.initVersion=function(){var e=this;return this.getVersionPromise||(this.getVersionPromise=Promise.resolve(this.getVersion().then((function(t){return t?console.log("Zabbix version detected: "+t):console.log("Failed to detect Zabbix version, use default 3.0.0"),e.version=t||"3.0.0",e.getVersionPromise=null,t})))),this.getVersionPromise},e.prototype.acknowledgeEvent=function(e,t,n,r){n||(n=be.a.gte(this.version,"4.0.0")?f.n:f.q);var a={eventids:e,message:t,action:n};return r&&(a.severity=r),this.request("event.acknowledge",a)},e.prototype.getGroups=function(){return this.request("hostgroup.get",{output:["name"],sortfield:"name",real_hosts:!0})},e.prototype.getHosts=function(e){var t={output:["name","host"],sortfield:"name"};return e&&(t.groupids=e),this.request("host.get",t)},e.prototype.getApps=function(e){var t={output:"extend",hostids:e};return this.request("application.get",t)},e.prototype.getItems=function(e,t,n){var r={output:["name","key_","value_type","hostid","status","state"],sortfield:"name",webitems:!0,filter:{},selectHosts:["hostid","name","host"]};return e&&(r.hostids=e),t&&(r.applicationids=t),"num"===n&&(r.filter.value_type=[0,3]),"text"===n&&(r.filter.value_type=[1,2,4]),this.request("item.get",r).then(p.f)},e.prototype.getItemsByIDs=function(e){var t={itemids:e,output:["name","key_","value_type","hostid","status","state"],webitems:!0,selectHosts:["hostid","name"]};return this.request("item.get",t).then((function(e){return p.f(e)}))},e.prototype.getMacros=function(e){var t={output:"extend",hostids:e};return this.request("usermacro.get",t)},e.prototype.getGlobalMacros=function(){return this.request("usermacro.get",{output:"extend",globalmacro:!0})},e.prototype.getLastValue=function(e){var t={output:["lastvalue"],itemids:e};return this.request("item.get",t).then((function(e){return e.length?e[0].lastvalue:null}))},e.prototype.getHistory=function(e,t,n){var r=this,a=i.a.groupBy(e,"value_type"),o=i.a.map(a,(function(e,a){var o={output:"extend",history:a,itemids:i.a.map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return n&&(o.time_till=n),r.request("history.get",o)}));return Promise.all(o).then(i.a.flatten)},e.prototype.getTrend_ZBXNEXT1193=function(e,t,n){var r=this,a=i.a.groupBy(e,"value_type"),o=i.a.map(a,(function(e,a){var o={output:"extend",trend:a,itemids:i.a.map(e,"itemid"),sortfield:"clock",sortorder:"ASC",time_from:t};return n&&(o.time_till=n),r.request("trend.get",o)}));return Promise.all(o).then(i.a.flatten)},e.prototype.getTrend_30=function(e,t,n,r){var a={output:["itemid","clock",r],itemids:i.a.map(e,"itemid"),time_from:t};return n&&(a.time_till=n),this.request("trend.get",a)},e.prototype.getITService=function(e){var t={output:"extend",serviceids:e};return this.request("service.get",t)},e.prototype.getSLA=function(e,t,n){var r=[{from:t[0],to:t[1]}];if("auto"===n.slaInterval)r=Se(t,function(e){var t=Te.a.round_interval(100*e)/1e3;return Math.max(t,f.c)}(n.intervalMs));else if("none"!==n.slaInterval){r=Se(t,p.n(n.slaInterval)/1e3)}var a={serviceids:e,intervals:r};return this.request("service.getsla",a)},e.prototype.getProblems=function(e,t,n,r){var a=r.timeFrom,o=r.timeTo,i=r.recent,s=r.severities,u=r.limit,c=r.acknowledged,l=r.tags,f={output:"extend",selectAcknowledges:"extend",selectSuppressionData:"extend",selectTags:"extend",source:"0",object:"0",sortfield:["eventid"],sortorder:"DESC",evaltype:"0",groupids:e,hostids:t,applicationids:n,recent:i};return s&&(f.severities=s),void 0!==c&&(f.acknowledged=c),l&&(f.tags=l),u&&(f.limit=u),(a||o)&&(f.time_from=a,f.time_till=o),this.request("problem.get",f).then(p.m)},e.prototype.getTriggersByIds=function(e){var t={output:"extend",triggerids:e,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,selectGroups:["name"],selectHosts:["name","host","maintenance_status","proxy_hostid"],selectItems:["name","key_","lastvalue"],preservekeys:"1"};return this.request("trigger.get",t).then(p.m)},e.prototype.getTriggers=function(e,t,n,r){var a=r.showTriggers,o=r.maintenance,i=r.timeFrom,s=r.timeTo,u={output:"extend",groupids:e,hostids:t,applicationids:n,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,filter:{value:1},selectGroups:["name"],selectHosts:["name","host","maintenance_status","proxy_hostid"],selectItems:["name","key_","lastvalue"],selectLastEvent:"extend",selectTags:"extend"};return a===xe.a.Problems?u.filter.value=1:a!==xe.a.Recent&&a!==xe.a.History||(u.filter.value=[0,1]),o&&(u.maintenance=!0),(i||s)&&(u.lastChangeSince=i,u.lastChangeTill=s),this.request("trigger.get",u)},e.prototype.getEvents=function(e,t,n,r,a){var o={output:"extend",time_from:t,time_till:n,objectids:e,select_acknowledges:"extend",selectHosts:"extend",value:r};return a&&(o.limit=a,o.sortfield="clock",o.sortorder="DESC"),this.request("event.get",o).then(p.m)},e.prototype.getEventsHistory=function(e,t,n,r){var a=r.timeFrom,o=r.timeTo,i=r.severities,s=r.limit,u=r.value,c={output:"extend",time_from:a,time_till:o,value:"1",source:"0",object:"0",evaltype:"0",sortfield:["eventid"],sortorder:"DESC",select_acknowledges:"extend",selectTags:"extend",selectSuppressionData:["maintenanceid","suppress_until"],groupids:e,hostids:t,applicationids:n};return s&&(c.limit=s),i&&(c.severities=i),u&&(c.value=u),this.request("event.get",c).then(p.m)},e.prototype.getExtendedEventData=function(e){var t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",selectTags:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t)},e.prototype.getEventAlerts=function(e){var t={eventids:e,output:["eventid","message","clock","error"],selectUsers:!0};return this.request("alert.get",t)},e.prototype.getAcknowledges=function(e){var t={output:"extend",eventids:e,preservekeys:!0,select_acknowledges:"extend",sortfield:"clock",sortorder:"DESC"};return this.request("event.get",t).then((function(e){return i.a.filter(e,(function(e){return e.acknowledges.length}))}))},e.prototype.getAlerts=function(e,t,n){var r={output:"extend",itemids:e,expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend"};return(t||n)&&(r.lastChangeSince=t,r.lastChangeTill=n),this.request("trigger.get",r)},e.prototype.getHostAlerts=function(e,t,n){var r=n.minSeverity,a=n.acknowledged,o=n.count,s=n.timeFrom,u=n.timeTo,c={output:"extend",hostids:e,min_severity:r,filter:{value:1},expandDescription:!0,expandData:!0,expandComment:!0,monitored:!0,skipDependent:!0,selectLastEvent:"extend",selectGroups:"extend",selectHosts:["host","name"]};return o&&0!==a&&1!==a&&(c.countOutput=!0),t&&t.length&&(c.applicationids=t),(s||u)&&(c.lastChangeSince=s,c.lastChangeTill=u),this.request("trigger.get",c).then((function(e){return o&&0!==a&&1!==a||(e=function(e,t){return 0===t?i.a.filter(e,(function(e){return"0"===e.lastEvent.acknowledged})):1===t?i.a.filter(e,(function(e){return"1"===e.lastEvent.acknowledged})):e}(e,a),o&&(e=e.length)),e}))},e.prototype.getProxies=function(){return this.request("proxy.get",{output:["proxyid","host"]})},e.prototype.getScripts=function(e,t){var n={output:"extend",hostids:e};return this.request("script.get",n).then(p.m)},e.prototype.executeScript=function(e,t){var n={hostid:e,scriptid:t};return this.request("script.execute",n)},e}();function Se(e,t){var n=e[0],r=e[1],a=[];n=Math.floor(n/t)*t,r=Math.ceil(r/t)*t;for(var o=n;o<=r-t;o+=t)a.push({from:o,to:o+t});return a}var we=function(){function e(e){this.code=e.code||null,this.name=e.message||"",this.data=e.data||"",this.message="Zabbix API Error: "+this.name+" "+this.data}return e.prototype.toString=function(){return this.name+" "+this.data},e}();var Ae={historyQuery:function(e,t,n,r,a,o){return"\n    SELECT CAST(itemid AS CHAR) AS metric, MIN(clock) AS time_sec, ".concat(o,"(value) AS value\n    FROM ").concat(t,"\n    WHERE itemid IN (").concat(e,")\n      AND clock > ").concat(n," AND clock < ").concat(r,"\n    GROUP BY (clock-").concat(n,") DIV ").concat(a,", metric\n    ORDER BY time_sec ASC\n  ")},trendsQuery:function(e,t,n,r,a,o,i){return"\n    SELECT CAST(itemid AS CHAR) AS metric, MIN(clock) AS time_sec, ".concat(o,"(").concat(i,") AS value\n    FROM ").concat(t,"\n    WHERE itemid IN (").concat(e,")\n      AND clock > ").concat(n," AND clock < ").concat(r,"\n    GROUP BY (clock-").concat(n,") DIV ").concat(a,", metric\n    ORDER BY time_sec ASC\n  ")},testQuery:function(){return"SELECT CAST(itemid AS CHAR) AS metric, clock AS time_sec, value_avg AS value FROM trends_uint LIMIT 1"}};var Pe="\n  SELECT to_char(itemid, '".concat("FM99999999999999999999","') AS metric, clock AS time, value_avg AS value\n  FROM trends_uint LIMIT 1\n");var Oe={historyQuery:function(e,t,n,r,a,o){var i="clock / ".concat(a," * ").concat(a);return"\n    SELECT to_char(itemid, '".concat("FM99999999999999999999","') AS metric, ").concat(i," AS time, ").concat(o,"(value) AS value\n    FROM ").concat(t,"\n    WHERE itemid IN (").concat(e,")\n      AND clock > ").concat(n," AND clock < ").concat(r,"\n    GROUP BY 1, 2\n    ORDER BY time ASC\n  ")},trendsQuery:function(e,t,n,r,a,o,i){var s="clock / ".concat(a," * ").concat(a);return"\n    SELECT to_char(itemid, '".concat("FM99999999999999999999","') AS metric, ").concat(s," AS time, ").concat(o,"(").concat(i,") AS value\n    FROM ").concat(t,"\n    WHERE itemid IN (").concat(e,")\n      AND clock > ").concat(n," AND clock < ").concat(r,"\n    GROUP BY 1, 2\n    ORDER BY time ASC\n  ")},testQuery:function(){return Pe}};function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ce(e,t){return(Ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ne(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Me(e);if(t){var a=Me(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _e(this,n)}}function _e(e,t){return!t||"object"!==Re(t)&&"function"!=typeof t?ke(e):t}function ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Le(e,t,n){return(Le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Me(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var je="postgres",Fe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ce(e,t)}(s,e);var t,n,r,o=Ne(s);function s(e){var t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e)).limit=e.limit||1e4,n.sqlDialect=null,Le((t=ke(n),Me(s.prototype)),"loadDBDataSource",t).call(t).then((function(){n.loadSQLDialect()})),n}return t=s,(n=[{key:"loadSQLDialect",value:function(){this.datasourceTypeId===je?this.sqlDialect=Oe:this.sqlDialect=Ae}},{key:"testDataSource",value:function(){var e=this.sqlDialect.testQuery();return this.invokeSQLQuery(e)}},{key:"getHistory",value:function(e,t,n,r){var a=this,o=r.intervalMs,s=r.consolidateBy,u=Math.ceil(o/1e3),c=Math.ceil((n-t)/u);u=(n-t)/c;var l=ge.consolidateByFunc[s=s||"avg"],f=i.a.groupBy(e,"value_type"),m=i.a.map(f,(function(e,r){var o=i.a.map(e,"itemid").join(", "),s=pe[r],c=a.sqlDialect.historyQuery(o,s,t,n,u,l);return c=Object(p.b)(c),a.invokeSQLQuery(c)}));return Promise.all(m).then((function(e){return i.a.flatten(e)}))}},{key:"getTrends",value:function(e,t,n,r){var a=this,o=r.intervalMs,s=r.consolidateBy,u=Math.ceil(o/1e3),c=Math.ceil((n-t)/u);u=(n-t)/c;var l=ge.consolidateByFunc[s=s||"avg"],f=i.a.groupBy(e,"value_type"),m=i.a.map(f,(function(e,r){var o=i.a.map(e,"itemid").join(", "),c=fe[r],f=i.a.includes(["avg","min","max","sum"],s)?s:"avg";f=ge.consolidateByTrendColumns[f];var m=a.sqlDialect.trendsQuery(o,c,t,n,u,l,f);return m=Object(p.b)(m),a.invokeSQLQuery(m)}));return Promise.all(m).then((function(e){return i.a.flatten(e)}))}},{key:"invokeSQLQuery",value:function(e){var t={refId:"A",format:"time_series",datasourceId:this.datasourceId,rawSql:e,maxDataPoints:this.limit};return Object(a.getBackendSrv)().datasourceRequest({url:"/api/tsdb/query",method:"POST",data:{queries:[t]}}).then((function(e){var t=e.data.results;return t.A?t.A.series:null}))}}])&&De(t.prototype,n),r&&De(t,r),s}(de);function qe(e){return(qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ve(e,t){return(Ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function He(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qe(e);if(t){var a=Qe(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Ge(this,n)}}function Ge(e,t){return!t||"object"!==qe(t)&&"function"!=typeof t?ze(e):t}function ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ue(e,t,n){return(Ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qe(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function Qe(e){return(Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $e={avg:"MEAN",min:"MIN",max:"MAX",sum:"SUM",count:"COUNT"},Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ve(e,t)}(o,e);var t,n,r,a=He(o);function o(e){var t,n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(n=a.call(this,e)).retentionPolicy=e.retentionPolicy,Ue((t=ze(n),Qe(o.prototype)),"loadDBDataSource",t).call(t).then((function(e){return n.influxDS=e,e})),n}return t=o,(n=[{key:"testDataSource",value:function(){return this.influxDS.testDatasource().then((function(e){return e.status&&"error"===e.status?Promise.reject({data:{message:"InfluxDB connection error: ".concat(e.message)}}):e}))}},{key:"getHistory",value:function(e,t,n,r){var a=this,o=r.intervalMs,s=r.consolidateBy,u=r.retentionPolicy,c=Math.ceil(o/1e3),l={timeFrom:t,timeTill:n};s=s||"avg";var p=i.a.groupBy(e,"value_type"),f=i.a.map(p,(function(e,t){var n=i.a.map(e,"itemid"),r=pe[t],o=a.buildHistoryQuery(n,r,l,c,s,u);return a.invokeInfluxDBQuery(o)}));return Promise.all(f).then(i.a.flatten).then((function(e){return function(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r.error){var a="InfluxDB error: ".concat(r.error);return Promise.reject(new Error(a))}if(r&&r.series)for(var o=e[n].series,i=0;i<o.length;i++){var s=o[i],u=[];if(s.values)for(n=0;n<s.values.length;n++)u[n]=[s.values[n][1],s.values[n][0]];var c={name:s.tags.itemid,points:u};t.push(c)}}return t}(e)}))}},{key:"getTrends",value:function(e,t,n,r){return r.retentionPolicy=this.retentionPolicy,this.getHistory(e,t,n,r)}},{key:"buildHistoryQuery",value:function(e,t,n,r,a,o){var i=n.timeFrom,s=n.timeTill,u=o?'"'.concat(o,'"."').concat(t,'"'):'"'.concat(t,'"'),c="value";o&&(c=me[a]||"value_avg");var l=$e[a]||a,f=this.buildWhereClause(e),m="SELECT ".concat(l,'("').concat(c,'") FROM ').concat(u,"\n      WHERE ").concat(f,' AND "time" >= ').concat(i,'s AND "time" <= ').concat(s,"s\n      GROUP BY time(").concat(r,'s), "itemid" fill(none)');return Object(p.b)(m)}},{key:"buildWhereClause",value:function(e){var t=e.map((function(e){return'"itemid" = \''.concat(e,"'")})).join(" OR ");return"(".concat(t,")")}},{key:"invokeInfluxDBQuery",value:function(e){return this.influxDS._seriesQuery(e).then((function(e){return e&&e.results?e.results:[]}))}}])&&Be(t.prototype,n),r&&Be(t,r),o}(de);var We=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r},Ye=["getHistory","getTrend","getGroups","getHosts","getApps","getItems","getMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getAcknowledges","getITService","getSLA","getVersion","getProxies","getEventAlerts","getExtendedEventData","getProblems","getEventsHistory","getTriggersByIds","getScripts"],Ze=["getGroups","getHosts","getApps","getItems","getMacros","getItemsByIDs","getITService","getProxies"],Je=["getHistory","getTrend","getMacros","getItemsByIDs","getEvents","getAlerts","getHostAlerts","getAcknowledges","getITService","getVersion","acknowledgeEvent","getProxies","getEventAlerts","getExtendedEventData","getScripts","executeScript"],Ke=function(){function e(e){var t=this,n=e.basicAuth,r=e.withCredentials,a=e.cacheTTL,o=e.enableDirectDBConnection,i=e.dbConnectionDatasourceId,s=e.dbConnectionDatasourceName,u=e.dbConnectionRetentionPolicy,c=e.datasourceId;this.enableDirectDBConnection=o;var l={enabled:!0,ttl:a};if(this.cachingProxy=new ie(l),this.zabbixAPI=new Ie(n,r,c),this.proxifyRequests(),this.cacheRequests(),this.bindRequests(),o){var p={dbConnectionRetentionPolicy:u};this.initDBConnector(i,s,p).then((function(){t.getHistoryDB=t.cachingProxy.proxifyWithCache(t.dbConnector.getHistory,"getHistory",t.dbConnector),t.getTrendsDB=t.cachingProxy.proxifyWithCache(t.dbConnector.getTrends,"getTrends",t.dbConnector)}))}}return e.prototype.initDBConnector=function(e,t,n){var r=this;return de.loadDatasource(e,t).then((function(a){var o={datasourceId:e,datasourceName:t};return"influxdb"===a.type?(o.retentionPolicy=n.dbConnectionRetentionPolicy,r.dbConnector=new Xe(o)):r.dbConnector=new Fe(o),r.dbConnector}))},e.prototype.proxifyRequests=function(){for(var e=0,t=Ye;e<t.length;e++){var n=t[e];this.zabbixAPI[n]=this.cachingProxy.proxify(this.zabbixAPI[n],n,this.zabbixAPI)}},e.prototype.cacheRequests=function(){for(var e=0,t=Ze;e<t.length;e++){var n=t[e];this.zabbixAPI[n]=this.cachingProxy.cacheRequest(this.zabbixAPI[n],n,this.zabbixAPI)}},e.prototype.bindRequests=function(){for(var e=0,t=Je;e<t.length;e++){var n=t[e];this[n]=this.zabbixAPI[n].bind(this.zabbixAPI)}},e.prototype.testDataSource=function(){var e,t,n=this;return this.getVersion().then((function(t){return e=t,n.getAllGroups()})).then((function(){return n.enableDirectDBConnection?n.dbConnector.testDataSource():Promise.resolve()})).catch((function(e){return Promise.reject(e)})).then((function(r){return r&&(t={dsType:n.dbConnector.datasourceTypeName,dsName:n.dbConnector.datasourceName}),{zabbixVersion:e,dbConnectorStatus:t}}))},e.prototype.getItemsFromTarget=function(e,t){var n=i.a.map(["group","host","application","item"],(function(t){return e[t].filter}));return this.getItems.apply(this,We(n,[t]))},e.prototype.getHostsFromTarget=function(e){var t=i.a.map(["group","host","application"],(function(t){return e[t].filter}));return Promise.all([this.getHosts.apply(this,t),this.getApps.apply(this,t)]).then((function(e){var t=e[0],n=e[1];return n.appFilterEmpty&&(n=[]),[t,n]}))},e.prototype.getAllGroups=function(){return this.zabbixAPI.getGroups()},e.prototype.getGroups=function(e){return this.getAllGroups().then((function(t){return tt(t,e)}))},e.prototype.getAllHosts=function(e){var t=this;return this.getGroups(e).then((function(e){var n=i.a.map(e,"groupid");return t.zabbixAPI.getHosts(n)}))},e.prototype.getHosts=function(e,t){return this.getAllHosts(e).then((function(e){return tt(e,t)}))},e.prototype.getAllApps=function(e,t){var n=this;return this.getHosts(e,t).then((function(e){var t=i.a.map(e,"hostid");return n.zabbixAPI.getApps(t)}))},e.prototype.getApps=function(e,t,n){var r=this;return this.getHosts(e,t).then((function(e){var t=i.a.map(e,"hostid");if(n)return r.zabbixAPI.getApps(t).then((function(e){return nt(e,n)}));var a=t;return a.hostids=t,a.appFilterEmpty=!0,Promise.resolve(a)}))},e.prototype.getAllItems=function(e,t,n,r){var a=this;return void 0===r&&(r={}),this.getApps(e,t,n).then((function(e){if(e.appFilterEmpty)return a.zabbixAPI.getItems(e.hostids,void 0,r.itemtype);var t=i.a.map(e,"applicationid");return a.zabbixAPI.getItems(void 0,t,r.itemtype)})).then((function(e){return r.showDisabledItems||(e=i.a.filter(e,{status:"0"})),e})).then(this.expandUserMacro.bind(this))},e.prototype.expandUserMacro=function(e,t){var n=function(e){var t=i.a.map(e,(function(e){return i.a.map(e.hosts,"hostid")}));return i.a.uniq(i.a.flatten(t))}(e);return this.getMacros(n).then((function(n){return i.a.forEach(e,(function(e){p.c(t?e.url:e.name)&&(t?e.url=p.r(e,n,t):e.name=p.r(e,n))})),e}))},e.prototype.getItems=function(e,t,n,r,a){return void 0===a&&(a={}),this.getAllItems(e,t,n,a).then((function(e){return nt(e,r)}))},e.prototype.getItemValues=function(e,t,n,r,a){var o=this;return void 0===a&&(a={}),this.getItems(e,t,n,r,a).then((function(e){var t=[oe()().subtract(2,"h").unix(),oe()().unix()];a.range&&(t=[a.range.from.unix(),a.range.to.unix()]);var n=t[0],r=t[1];return o.zabbixAPI.getHistory(e,n,r).then((function(e){return e?i.a.uniq(e.map((function(e){return e.value}))).map((function(e){return{name:e}})):[]}))}))},e.prototype.getITServices=function(e){return this.zabbixAPI.getITService().then((function(t){return tt(t,e)}))},e.prototype.getProblems=function(e,t,n,r,a){var o=this,s=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,n)];return Promise.all(s).then((function(r){var a=r[0],o=r[1],s=r[2],u={};return n&&(u.applicationids=i.a.flatten(i.a.map(s,"applicationid"))),t&&"/.*/"!==t&&(u.hostids=i.a.map(o,"hostid")),e&&(u.groupids=i.a.map(a,"groupid")),u})).then((function(e){return o.zabbixAPI.getProblems(e.groupids,e.hostids,e.applicationids,a)})).then((function(e){var t=null==e?void 0:e.map((function(e){return e.objectid}));return Promise.all([Promise.resolve(e),o.zabbixAPI.getTriggersByIds(t)])})).then((function(e){return te(e[0],e[1])})).then((function(e){return o.filterTriggersByProxy(e,r)}))},e.prototype.getProblemsHistory=function(e,t,n,r,a){var o=this,s=a.valueFromEvent,u=[this.getGroups(e),this.getHosts(e,t),this.getApps(e,t,n)];return Promise.all(u).then((function(r){var a=r[0],o=r[1],s=r[2],u={};return n&&(u.applicationids=i.a.flatten(i.a.map(s,"applicationid"))),t&&(u.hostids=i.a.map(o,"hostid")),e&&(u.groupids=i.a.map(a,"groupid")),u})).then((function(e){return o.zabbixAPI.getEventsHistory(e.groupids,e.hostids,e.applicationids,a)})).then((function(e){var t=null==e?void 0:e.map((function(e){return e.objectid}));return Promise.all([Promise.resolve(e),o.zabbixAPI.getTriggersByIds(t)])})).then((function(e){return ne(e[0],e[1],{valueFromEvent:s})})).then((function(e){return o.filterTriggersByProxy(e,r)}))},e.prototype.filterTriggersByProxy=function(e,t){return this.getFilteredProxies(t).then((function(n){if(t&&"/.*/"!==t&&e){var r=n.map((function(e){return e.proxyid}));e=e.filter((function(e){for(var t=0;t<e.hosts.length;t++){var n=e.hosts[t];if(r.includes(n.proxy_hostid))return!0}return!1}))}return e}))},e.prototype.getFilteredProxies=function(e){return this.zabbixAPI.getProxies().then((function(t){return t.forEach((function(e){return e.name=e.host})),tt(t,e)}))},e.prototype.getHistoryTS=function(e,t,n){var r=this,a=t[0],o=t[1];return this.enableDirectDBConnection?this.getHistoryDB(e,a,o,n).then((function(t){return r.dbConnector.handleGrafanaTSResponse(t,e)})):this.zabbixAPI.getHistory(e,a,o).then((function(t){return ee.handleHistory(t,e)}))},e.prototype.getTrends=function(e,t,n){var r=this,a=t[0],o=t[1];if(this.enableDirectDBConnection)return this.getTrendsDB(e,a,o,n).then((function(t){return r.dbConnector.handleGrafanaTSResponse(t,e)}));var i=n.consolidateBy||n.valueType;return this.zabbixAPI.getTrend(e,a,o).then((function(t){return ee.handleTrends(t,e,i)})).then(ee.sortTimeseries)},e.prototype.getHistoryText=function(e,t,n){var r=t[0],a=t[1];return e.length?this.zabbixAPI.getHistory(e,r,a).then((function(t){return"table"===n.resultFormat?ee.handleHistoryAsTable(t,e,n):ee.handleText(t,e,n)})):Promise.resolve([])},e.prototype.getSLA=function(e,t,n,r){var a=i.a.map(e,"serviceid");return this.zabbixAPI.getSLA(a,t,r).then((function(t){return i.a.map(a,(function(r){var a=i.a.find(e,{serviceid:r});return ee.handleSLAResponse(a,n.slaProperty,t)}))}))},e}();function et(e,t){var n=p.a(t);return i.a.filter(e,(function(e){return n.test(e.name)}))}function tt(e,t){return p.k(t)?et(e,t):function(e,t){var n=i.a.find(e,{name:t});return n?[n]:[]}(e,t)}function nt(e,t){return p.k(t)?et(e,t):function(e,t){var n=i.a.filter(e,{name:t});return n||[]}(e,t)}var rt,at=(rt=function(e,t){return(rt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}rt(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ot=function(){return(ot=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},it=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))},st=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},ut=function(e){function t(t,n){var r=e.call(this,t)||this;r.templateSrv=n,r.templateSrv=n,r.enableDebugLog="development"===u.a.buildInfo.env,r.replaceTemplateVars=i.a.partial(mt,r.templateSrv),r.datasourceId=t.id,r.name=t.name,r.basicAuth=t.basicAuth,r.withCredentials=t.withCredentials;var a=h(t.jsonData);r.trends=a.trends,r.trendsFrom=a.trendsFrom||"7d",r.trendsRange=a.trendsRange||"4d";var o=a.cacheTTL||"1h";r.cacheTTL=p.n(o),r.disableReadOnlyUsersAck=a.disableReadOnlyUsersAck,r.enableDirectDBConnection=a.dbConnectionEnable||!1,r.dbConnectionDatasourceId=a.dbConnectionDatasourceId,r.dbConnectionDatasourceName=a.dbConnectionDatasourceName,r.dbConnectionRetentionPolicy=a.dbConnectionRetentionPolicy;var s={basicAuth:r.basicAuth,withCredentials:r.withCredentials,cacheTTL:r.cacheTTL,enableDirectDBConnection:r.enableDirectDBConnection,dbConnectionDatasourceId:r.dbConnectionDatasourceId,dbConnectionDatasourceName:r.dbConnectionDatasourceName,dbConnectionRetentionPolicy:r.dbConnectionRetentionPolicy,datasourceId:r.datasourceId};return r.zabbix=new Ke(s),r}return at(t,e),t.$inject=["instanceSettings","templateSrv"],t.prototype.query=function(e){var t=this,n=i.a.map(e.targets,(function(n){if(n.hide)return[];var r=Math.ceil(l.parse(e.range.from)/1e3),a=Math.ceil(l.parse(e.range.to)/1e3);e.scopedVars=Object.assign({},e.scopedVars,p.i(e.range));var o=i.a.cloneDeep(n);o=m(o),t.replaceTargetVariables(o,e);var s=ct(o.functions,"Time");if(s.length){var u=p.s(s)([r,a]);r=u[0],a=u[1]}var c=[r,a],d=t.isUseTrends(c);return o.queryType&&o.queryType!==f.f&&o.queryType!==f.h?o.queryType===f.d?o.itemids?t.queryItemIdData(o,c,d,e):[]:o.queryType===f.e?t.queryITServiceData(o,c,e):o.queryType===f.i?t.queryTriggersData(o,c):o.queryType===f.g?t.queryProblems(o,c,e):[]:o.group&&o.host&&o.item?o.queryType&&o.queryType!==f.f?o.queryType===f.h?t.queryTextData(o,c):[]:t.queryNumericData(o,c,d,e):[]}));return Promise.all(i.a.flatten(n)).then(i.a.flatten).then((function(e){return{data:e}}))},t.prototype.doTsdbRequest=function(e){var t=this,n={queries:e.targets.map((function(e){return e.datasourceId=t.datasourceId,e.queryType="zabbixAPI",e}))};return e.range&&(n.from=e.range.from.valueOf().toString(),n.to=e.range.to.valueOf().toString()),Object(a.getBackendSrv)().post("/api/tsdb/query",n)},t.prototype.doTSDBConnectionTest=function(){var e={queries:[{datasourceId:this.datasourceId,queryType:"connectionTest"}]};return Object(a.getBackendSrv)().post("/api/tsdb/query",e)},t.prototype.queryNumericData=function(e,t,n,r){var a,o,i=this;return this.zabbix.getItemsFromTarget(e,{itemtype:"num"}).then((function(o){return a=(new Date).getTime(),i.queryNumericDataForItems(o,e,t,n,r)})).then((function(e){return o=(new Date).getTime(),i.enableDebugLog&&console.log("Datasource::Performance Query Time ("+i.name+"): "+(o-a)),e}))},t.prototype.queryNumericDataForItems=function(e,t,n,r,a){var o=this;return a.valueType=this.getTrendValueType(t),a.consolidateBy=function(e){var t,n=i.a.find(e.functions,(function(e){return"consolidateBy"===e.def.name}));n&&n.params&&n.params.length&&(t=n.params[0]);return t}(t)||a.valueType,(r?this.zabbix.getTrends(e,n,a):this.zabbix.getHistoryTS(e,n,a)).then((function(e){return o.applyDataProcessingFunctions(e,t)})).then((function(e){return function(e,t){var n=U.aggregationFunctions.avg,r=U.aggregationFunctions[t.consolidateBy]||n;return i.a.map(e,(function(e){return e.datapoints.length>t.maxDataPoints&&(e.datapoints=U.groupBy(t.interval,r,e.datapoints)),e}))}(e,a)}))},t.prototype.getTrendValueType=function(e){var t=i.a.map(T().Trends,"name"),n=i.a.find(e.functions,(function(e){return i.a.includes(t,e.def.name)}));return n?n.params[0]:"avg"},t.prototype.applyDataProcessingFunctions=function(e,t){var n=ct(t.functions,"Transform"),r=ct(t.functions,"Aggregate"),a=ct(t.functions,"Filter"),o=ct(t.functions,"Alias");if(e=i.a.cloneDeep(i.a.map(e,(function(e){return e.datapoints=p.s(n)(e.datapoints),e}))),a.length&&(e=p.s(a)(e)),r.length){var s=i.a.map(e,"datapoints");s=p.s(r)(s);var u=i.a.map(T().Aggregate,"name");e=[{target:i.a.findLast(t.functions,(function(e){return i.a.includes(u,e.def.name)})).text,datapoints:s}]}return i.a.forEach(e,p.s(o).bind(this)),this.applyTimeShiftFunction(e,t),e},t.prototype.applyTimeShiftFunction=function(e,t){var n=i.a.find(t.functions,(function(e){return"timeShift"===e.def.name}));if(n){var r=n.params[0];i.a.forEach(e,(function(e){e.datapoints=U.unShiftTimeSeries(r,e.datapoints)}))}},t.prototype.queryTextData=function(e,t){var n=this;return this.zabbix.getItemsFromTarget(e,{itemtype:"text"}).then((function(r){return n.zabbix.getHistoryText(r,t,e)}))},t.prototype.queryItemIdData=function(e,t,n,r){var a=this,o=e.itemids;return o=this.templateSrv.replace(o,r.scopedVars,ft),(o=i.a.map(o.split(","),(function(e){return e.trim()})))?this.zabbix.getItemsByIDs(o).then((function(o){return a.queryNumericDataForItems(o,e,t,n,r)})):[]},t.prototype.queryITServiceData=function(e,t,n){var r,a=this;return e.hide||!e.itservice&&!e.itServiceFilter||!e.slaProperty?[]:(n.isOldVersion=e.itservice&&!e.itServiceFilter,r=n.isOldVersion?"/.*/":this.replaceTemplateVars(e.itServiceFilter,n.scopedVars),n.slaInterval=e.slaInterval,this.zabbix.getITServices(r).then((function(r){var o;return n.isOldVersion&&(r=i.a.filter(r,{serviceid:null===(o=e.itservice)||void 0===o?void 0:o.serviceid})),a.zabbix.getSLA(r,t,e,n)})).then((function(t){return a.applyDataProcessingFunctions(t,e)})))},t.prototype.queryTriggersData=function(e,t){var n=this,r=t[0],a=t[1];return this.zabbix.getHostsFromTarget(e).then((function(o){var s=o[0],u=o[1];if(s.length){var c=i.a.map(s,"hostid"),l=i.a.map(u,"applicationid"),p={minSeverity:e.triggers.minSeverity,acknowledged:e.triggers.acknowledged,count:e.triggers.count,timeFrom:r,timeTo:a},f=e.group.filter;return Promise.all([n.zabbix.getHostAlerts(c,l,p),n.zabbix.getGroups(f)]).then((function(e){var n=e[0],r=e[1];return ee.handleTriggersResponse(n,r,t)}))}return Promise.resolve([])}))},t.prototype.queryProblems=function(e,t,n){var r,a,o,s,u,l,f,m,d,h,v,g,y,b,E,T=t[0],x=t[1],I=c.contextSrv.isEditor||c.contextSrv.isGrafanaAdmin,S=e.showProblems||xe.a.Problems,w=e.options.hostProxy?this.zabbix.getProxies():function(){return[]};E=!this.disableReadOnlyUsersAck||I;var A=this.replaceTemplateVars(null===(r=e.group)||void 0===r?void 0:r.filter,n.scopedVars),P=this.replaceTemplateVars(null===(a=e.host)||void 0===a?void 0:a.filter,n.scopedVars),O=this.replaceTemplateVars(null===(o=e.application)||void 0===o?void 0:o.filter,n.scopedVars),R=this.replaceTemplateVars(null===(s=e.proxy)||void 0===s?void 0:s.filter,n.scopedVars),D=this.replaceTemplateVars(null===(u=e.trigger)||void 0===u?void 0:u.filter,n.scopedVars),C=this.replaceTemplateVars(null===(l=e.tags)||void 0===l?void 0:l.filter,n.scopedVars),N=ot(ot({},e),{trigger:{filter:D},tags:{filter:C}}),_=C.replace("/^","").replace("$/",""),k=p.p(_);k.forEach((function(e){e.operator=1}));var L,M={recent:S===xe.a.Recent,minSeverity:null===(f=e.options)||void 0===f?void 0:f.minSeverity,limit:null===(m=e.options)||void 0===m?void 0:m.limit};if(k&&k.length&&(M.tags=k),0!==(null===(d=e.options)||void 0===d?void 0:d.acknowledged)&&1!==(null===(h=e.options)||void 0===h?void 0:h.acknowledged)||(M.acknowledged=!!(null===(v=e.options)||void 0===v?void 0:v.acknowledged)),null===(g=e.options)||void 0===g?void 0:g.minSeverity){var j=[0,1,2,3,4,5].filter((function(t){var n;return t>=(null===(n=e.options)||void 0===n?void 0:n.minSeverity)}));(null===(y=e.options)||void 0===y?void 0:y.severities)&&(j=j.filter((function(t){var n;return null===(n=e.options)||void 0===n?void 0:n.severities.includes(t)}))),M.severities=j}return S===xe.a.History?(M.timeFrom=T,M.timeTo=x,L=this.zabbix.getProblemsHistory(A,P,O,R,M)):L=this.zabbix.getProblems(A,P,O,R,M),Promise.all([L,w]).then((function(e){var t=e[0],n=e[1];return b=i.a.keyBy(n,"proxyid"),t})).then((function(e){return re.setMaintenanceStatus(e)})).then((function(e){return re.setAckButtonStatus(e,E)})).then((function(e){return re.filterTriggersPre(e,N)})).then((function(t){return re.sortProblems(t,e)})).then((function(t){return re.addTriggerDataSource(t,e)})).then((function(e){return re.addTriggerHostProxy(e,b)})).then((function(e){return re.toDataFrame(e)}))},t.prototype.testDatasource=function(){return it(this,void 0,void 0,(function(){var e,t,n,r,a;return st(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.zabbix.testDataSource()];case 1:return e=o.sent(),t=e.zabbixVersion,n=e.dbConnectorStatus,r="Zabbix API version: "+t,n&&(r+=", DB connector type: "+n.dsType),[2,{status:"success",title:"Success",message:r}];case 2:return(a=o.sent())instanceof we?[2,{status:"error",title:a.message,message:a.message}]:a.data&&a.data.message?[2,{status:"error",title:"Zabbix Client Error",message:a.data.message}]:"string"==typeof a?[2,{status:"error",title:"Unknown Error",message:a}]:(console.log(a),[2,{status:"error",title:"Connection failed",message:"Could not connect to given url"}]);case 3:return[2]}}))}))},t.prototype.metricFindQuery=function(e,t){var n,r=i.a.cloneDeep(e);if(!e)return Promise.resolve([]);"string"==typeof e&&(r=p.o(e));for(var a=0,o=["group","host","application","item"];a<o.length;a++){var s=o[a];r[s]=this.replaceTemplateVars(r[s],{})}var u=r.group,c=r.host,l=r.application,f=r.item;switch(r.queryType){case xe.b.Group:n=this.zabbix.getGroups(r.group);break;case xe.b.Host:n=this.zabbix.getHosts(r.group,r.host);break;case xe.b.Application:n=this.zabbix.getApps(r.group,r.host,r.application);break;case xe.b.Item:n=this.zabbix.getItems(r.group,r.host,r.application,r.item);break;case xe.b.ItemValues:var m=null==t?void 0:t.range;n=this.zabbix.getItemValues(u,c,l,f,{range:m});break;default:n=Promise.resolve([])}return n.then((function(e){return i.a.map(e,lt)}))},t.prototype.annotationQuery=function(e){var t=this,n=e.range||e.rangeRaw,r=Math.ceil(l.parse(n.from)/1e3),a=Math.ceil(l.parse(n.to)/1e3),o=e.annotation,s={value:o.showOkEvents?["0","1"]:"1",valueFromEvent:!0,timeFrom:r,timeTo:a};if(o.minseverity){var u=[0,1,2,3,4,5].filter((function(e){return e>=Number(o.minseverity)}));s.severities=u}var c=this.replaceTemplateVars(o.group,{}),f=this.replaceTemplateVars(o.host,{}),m=this.replaceTemplateVars(o.application,{});return this.zabbix.getProblemsHistory(c,f,m,void 0,s).then((function(e){var n=t.replaceTemplateVars(o.trigger,{});return p.k(n)?e=i.a.filter(e,(function(e){return p.a(n).test(e.description)})):n&&(e=i.a.filter(e,(function(e){return e.description===n}))),o.hideAcknowledged&&(e=i.a.filter(e,(function(e){var t;return!(null===(t=e.acknowledges)||void 0===t?void 0:t.length)}))),i.a.map(e,(function(e){var t=p.g(e.acknowledges),n=[];return o.showHostname&&(n=i.a.map(e.hosts,"name")),{title:"1"===e.value?"Problem":"OK",time:1e3*e.timestamp,annotation:o,text:e.name+t,tags:n}}))}))},t.prototype.replaceTargetVariables=function(e,t){var n=this;i.a.forEach(["group","host","application","item"],(function(r){e[r]&&e[r].filter&&(e[r].filter=n.replaceTemplateVars(e[r].filter,t.scopedVars))})),e.textFilter=this.replaceTemplateVars(e.textFilter,t.scopedVars),i.a.forEach(e.functions,(function(e){e.params=i.a.map(e.params,(function(e){return"number"==typeof e?+n.templateSrv.replace(e.toString(),t.scopedVars):n.templateSrv.replace(e,t.scopedVars)}))}))},t.prototype.isUseTrends=function(e){var t=e[0],n=e[1],r=Math.ceil(l.parse("now-"+this.trendsFrom)/1e3),a=Math.ceil(p.n(this.trendsRange)/1e3);return this.trends&&(t<r||n-t>a)},t}(r.DataSourceApi);function ct(e,t){var n=i.a.map(T()[t],"name"),r=i.a.filter(e,(function(e){return i.a.includes(n,e.def.name)}));return i.a.map(r,(function(e){return E(e.def,e.params).bindFunction(U.metricFunctions)}))}function lt(e){return{text:e.name,expandable:!1}}function pt(e){return"string"==typeof e?p.d(e):"("+i.a.map(e,p.d).join("|")+")"}function ft(e){return"string"==typeof e?e:e.join(",")}function mt(e,t,n){var r=e.replace(t,n,pt);return t===r||p.k(r)||(r="/^"+r+"$/"),r}var dt=n(18),ht=n(21),vt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var gt,yt,bt,Et,Tt=function(e){function t(t,n,r,a,o){var s=e.call(this,t,n)||this;return s.zabbix=s.datasource.zabbix,s.replaceTemplateVars=s.datasource.replaceTemplateVars,s.templateSrv=o,s.editorModes=[{value:"num",text:"Metrics",queryType:f.f},{value:"text",text:"Text",queryType:f.h},{value:"itservice",text:"IT Services",queryType:f.e},{value:"itemid",text:"Item ID",queryType:f.d},{value:"triggers",text:"Triggers",queryType:f.i},{value:"problems",text:"Problems",queryType:f.g}],s.$scope.editorMode={METRICS:f.f,TEXT:f.h,ITSERVICE:f.e,ITEMID:f.d,TRIGGERS:f.i,PROBLEMS:f.g},s.slaPropertyList=[{name:"Status",property:"status"},{name:"SLA",property:"sla"},{name:"OK time",property:"okTime"},{name:"Problem time",property:"problemTime"},{name:"Down time",property:"downtimeTime"}],s.slaIntervals=[{text:"No interval",value:"none"},{text:"Auto",value:"auto"},{text:"1 hour",value:"1h"},{text:"12 hours",value:"12h"},{text:"24 hours",value:"1d"},{text:"1 week",value:"1w"},{text:"1 month",value:"1M"}],s.ackFilters=[{text:"all triggers",value:2},{text:"unacknowledged",value:0},{text:"acknowledged",value:1}],s.problemAckFilters=["all triggers","unacknowledged","acknowledged"],s.sortByFields=[{text:"Default",value:"default"},{text:"Last change",value:"lastchange"},{text:"Severity",value:"severity"}],s.showEventsFields=[{text:"All",value:[0,1]},{text:"OK",value:[0]},{text:"Problems",value:1}],s.showProblemsOptions=[{text:"Problems",value:"problems"},{text:"Recent problems",value:"recent"},{text:"History",value:"history"}],s.resultFormats=[{text:"Time series",value:"time_series"},{text:"Table",value:"table"}],s.severityOptions=f.k,s.getGroupNames=i.a.bind(s.getMetricNames,s,"groupList"),s.getHostNames=i.a.bind(s.getMetricNames,s,"hostList",!0),s.getApplicationNames=i.a.bind(s.getMetricNames,s,"appList"),s.getItemNames=i.a.bind(s.getMetricNames,s,"itemList"),s.getITServices=i.a.bind(s.getMetricNames,s,"itServiceList"),s.getProxyNames=i.a.bind(s.getMetricNames,s,"proxyList"),s.getVariables=i.a.bind(s.getTemplateVariables,s),r.$on("template-variable-value-updated",(function(){return s.onVariableChange()})),t.$on("typeahead-updated",(function(){s.onTargetBlur()})),s.init=function(){var e=this.target;e=m(e);var t={metric:{},oldTarget:i.a.cloneDeep(this.target),queryOptionsText:this.renderQueryOptionsText()};i.a.defaults(this,t);var n={queryType:f.f,group:{filter:""},host:{filter:""},application:{filter:""},item:{filter:""},functions:[],triggers:{count:!0,minSeverity:3,acknowledged:2},trigger:{filter:""},tags:{filter:""},proxy:{filter:""},options:{showDisabledItems:!1,skipEmptyValues:!1},table:{skipEmptyValues:!1}};i.a.defaultsDeep(e,n),this.panel.type===f.l&&(e.queryType=f.g,e.options.severities=function(e){if(!e)return[0,1,2,3,4,5];for(var t=[],n=0,r=e;n<r.length;n++){var a=r[n];a.show&&t.push(a.priority)}return t}(this.panel.triggerSeverity)),e.functions=i.a.map(e.functions,(function(e){return E(e.def,e.params)})),e.queryType===f.e&&i.a.defaultsDeep(e,{slaProperty:{name:"SLA",property:"sla"},slaInterval:"none"}),e.queryType===f.g&&i.a.defaultsDeep(e,{showProblems:xe.a.Problems,options:{minSeverity:0,sortProblems:"default",acknowledged:2,hostsInMaintenance:!1,hostProxy:!1,limit:f.b}}),e.queryType===f.f||e.queryType===f.h||e.queryType===f.i||e.queryType===f.g?this.initFilters():e.queryType===f.e&&this.suggestITServices()},s.panel.type===f.l&&(s.panel.schemaVersion=ht.a),s.init(),s.queryOptionsText=s.renderQueryOptionsText(),s}return t.$inject=["$scope","$injector","$rootScope","$sce","templateSrv"],vt(t,e),t.prototype.initFilters=function(){var e=i.a.find(this.editorModes,{queryType:this.target.queryType}),t=e?e.value:null,n=[this.suggestGroups(),this.suggestHosts(),this.suggestApps()];return this.target.queryType!==f.f&&this.target.queryType!==f.h||n.push(this.suggestItems(t)),this.target.queryType===f.g&&n.push(this.suggestProxies()),Promise.all(n)},t.prototype.getMetricNames=function(e,t){var n=i.a.uniq(i.a.map(this.metric[e],"name"));return i.a.forEach(this.templateSrv.variables,(function(e){n.unshift("$"+e.name)})),t&&n.unshift("/.*/"),n},t.prototype.getTemplateVariables=function(){return i.a.map(this.templateSrv.variables,(function(e){return"$"+e.name}))},t.prototype.suggestGroups=function(){var e=this;return this.zabbix.getAllGroups().then((function(t){return e.metric.groupList=t,t}))},t.prototype.suggestHosts=function(){var e=this,t=this.replaceTemplateVars(this.target.group.filter);return this.zabbix.getAllHosts(t).then((function(t){return e.metric.hostList=t,t}))},t.prototype.suggestApps=function(){var e=this,t=this.replaceTemplateVars(this.target.group.filter),n=this.replaceTemplateVars(this.target.host.filter);return this.zabbix.getAllApps(t,n).then((function(t){return e.metric.appList=t,t}))},t.prototype.suggestItems=function(e){var t=this;void 0===e&&(e="num");var n=this.replaceTemplateVars(this.target.group.filter),r=this.replaceTemplateVars(this.target.host.filter),a=this.replaceTemplateVars(this.target.application.filter),o={itemtype:e,showDisabledItems:this.target.options.showDisabledItems};return this.zabbix.getAllItems(n,r,a,o).then((function(e){return t.metric.itemList=e,e}))},t.prototype.suggestITServices=function(){var e=this;return this.zabbix.getITService().then((function(t){return e.metric.itServiceList=t,t}))},t.prototype.suggestProxies=function(){var e=this;return this.zabbix.getProxies().then((function(t){var n=i.a.map(t,"host");return e.metric.proxyList=n,n}))},t.prototype.isRegex=function(e){return p.k(e)},t.prototype.isVariable=function(e){return p.l(e,this.templateSrv.variables)},t.prototype.onTargetBlur=function(){var e=i.a.cloneDeep(this.target);i.a.isEqual(this.oldTarget,this.target)||(this.oldTarget=e,this.targetChanged())},t.prototype.oldTarget=function(e,t){throw new Error("Method not implemented.")},t.prototype.onVariableChange=function(){this.isContainsVariables()&&this.targetChanged()},t.prototype.isContainsVariables=function(){var e=this;return i.a.some(["group","host","application"],(function(t){return!(!e.target[t]||!e.target[t].filter)&&p.l(e.target[t].filter,e.templateSrv.variables)}))},t.prototype.parseTarget=function(){},t.prototype.validateTarget=function(){},t.prototype.targetChanged=function(){this.initFilters(),this.parseTarget(),this.panelCtrl.refresh()},t.prototype.addFunction=function(e){var t=E(e);t.added=!0,this.target.functions.push(t),this.moveAliasFuncLast(),(t.params.length&&t.added||0===t.def.params.length)&&this.targetChanged()},t.prototype.removeFunction=function(e){this.target.functions=i.a.without(this.target.functions,e),this.targetChanged()},t.prototype.moveFunction=function(e,t){var n=this.target.functions.indexOf(e);i.a.move(this.target.functions,n,n+t),this.targetChanged()},t.prototype.moveAliasFuncLast=function(){var e=i.a.find(this.target.functions,(function(e){return"Alias"===e.def.category}));e&&(this.target.functions=i.a.without(this.target.functions,e),this.target.functions.push(e))},t.prototype.toggleQueryOptions=function(){this.showQueryOptions=!this.showQueryOptions},t.prototype.onQueryOptionChange=function(){this.queryOptionsText=this.renderQueryOptionsText(),this.onTargetBlur()},t.prototype.renderQueryOptionsText=function(){var e={};this.target.queryType===f.f?e={showDisabledItems:"Show disabled items"}:this.target.queryType!==f.g&&this.target.queryType!==f.i||(e={sortProblems:"Sort problems",acknowledged:"Acknowledged",skipEmptyValues:"Skip empty values",hostsInMaintenance:"Show hosts in maintenance",limit:"Limit problems",hostProxy:"Show proxy"});var t=[];return i.a.forOwn(this.target.options,(function(n,r){if(n&&e[r])if(!0===n)t.push(e[r]);else{var a=n;n&&n.text?a=n.text:n&&n.value&&(a=n.value),t.push(e[r]+" = "+a)}})),"Options: "+t.join(", ")},t.prototype.switchEditorMode=function(e){this.target.queryType=e,this.queryOptionsText=this.renderQueryOptionsText(),this.init(),this.targetChanged()},t}(dt.QueryCtrl),xt=n(0),It=n.n(xt),St=n(6),wt=n(5),At=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},Pt=function(){return(Pt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Ot=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},Rt=(null===(yt=wt.LegacyForms)||void 0===yt?void 0:yt.Input)||wt.Input,Dt=RegExp("^"+p.t.source),Ct=((gt={})[wt.EventsWithValidation.onBlur]=[{rule:function(e){return!e||!(e.length>1&&"/"===e[0]&&"/"!==e[e.length-1])},errorMessage:"Not a valid regex"},{rule:function(e){return"*"!==e},errorMessage:"Wildcards not supported. Use /.*/ instead"}],gt),Nt=function(e){var t=e.value,n=(e.ref,e.validationEvents,Ot(e,["value","ref","validationEvents"])),r=function(e){return{inputRegex:Object(St.css)(bt||(bt=At(["\n    color: ","\n  "],["\n    color: ","\n  "])),e.palette.orange),inputVariable:Object(St.css)(Et||(Et=At(["\n    color: ","\n  "],["\n    color: ","\n  "])),e.colors.textBlue)}}(Object(wt.useTheme)()),a=r.inputRegex;return Dt.test(t)?a=r.inputVariable:Object(p.k)(t)&&(a=r.inputRegex),It.a.createElement(Rt,Pt({className:a,value:t,validationEvents:Ct},n))},_t=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),kt=function(){return(kt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Lt=function(e){function t(t){var n=e.call(this,t)||this;if(n.queryTypes=[{value:xe.b.Group,label:"Group"},{value:xe.b.Host,label:"Host"},{value:xe.b.Application,label:"Application"},{value:xe.b.Item,label:"Item"},{value:xe.b.ItemValues,label:"Item values"}],n.defaults={selectedQueryType:{value:xe.b.Group,label:"Group"},queryType:xe.b.Group,group:"/.*/",host:"",application:"",item:""},n.handleQueryUpdate=function(e,t){var r=e.currentTarget.value;n.setState((function(e){var n=kt({},e);return n[t]=r,kt({},n)}))},n.handleQueryChange=function(){var e=n.state,t=e.queryType,r={queryType:t,group:e.group,host:e.host,application:e.application,item:e.item};n.props.onChange(r,"Zabbix - "+t)},n.handleQueryTypeChange=function(e){n.setState(kt(kt({},n.state),{selectedQueryType:e,queryType:e.value}));var t=n.state,r=t.group,a=t.host,o=t.application,i=t.item,s=e.value,u={queryType:s,group:r,host:a,application:o,item:i};n.props.onChange(u,"Zabbix - "+s)},n.props.query&&"string"==typeof n.props.query){var r=Object(p.o)(n.props.query),a=n.getSelectedQueryType(r.queryType);n.state=kt({selectedQueryType:a,legacyQuery:n.props.query},r)}else if(n.props.query){r=n.props.query,a=n.getSelectedQueryType(r.queryType);n.state=kt(kt(kt({},n.defaults),r),{selectedQueryType:a})}else n.state=n.defaults;return n}return _t(t,e),t.prototype.getSelectedQueryType=function(e){return this.queryTypes.find((function(t){return t.value===e}))},t.prototype.render=function(){var e=this,t=this.state,n=t.selectedQueryType,r=t.legacyQuery,a=t.group,o=t.host,i=t.application,s=t.item;return It.a.createElement(It.a.Fragment,null,It.a.createElement("div",{className:"gf-form max-width-21"},It.a.createElement(wt.InlineFormLabel,{width:10},"Query Type"),It.a.createElement(wt.Select,{width:11,value:n,options:this.queryTypes,onChange:this.handleQueryTypeChange})),It.a.createElement("div",{className:"gf-form-inline"},It.a.createElement("div",{className:"gf-form max-width-30"},It.a.createElement(wt.InlineFormLabel,{width:10},"Group"),It.a.createElement(Nt,{value:a,onChange:function(t){return e.handleQueryUpdate(t,"group")},onBlur:this.handleQueryChange})),n.value!==xe.b.Group&&It.a.createElement("div",{className:"gf-form max-width-30"},It.a.createElement(wt.InlineFormLabel,{width:10},"Host"),It.a.createElement(Nt,{value:o,onChange:function(t){return e.handleQueryUpdate(t,"host")},onBlur:this.handleQueryChange}))),(n.value===xe.b.Application||n.value===xe.b.Item||n.value===xe.b.ItemValues)&&It.a.createElement("div",{className:"gf-form-inline"},It.a.createElement("div",{className:"gf-form max-width-30"},It.a.createElement(wt.InlineFormLabel,{width:10},"Application"),It.a.createElement(Nt,{value:i,onChange:function(t){return e.handleQueryUpdate(t,"application")},onBlur:this.handleQueryChange})),(n.value===xe.b.Item||n.value===xe.b.ItemValues)&&It.a.createElement("div",{className:"gf-form max-width-30"},It.a.createElement(wt.InlineFormLabel,{width:10},"Item"),It.a.createElement(Nt,{value:s,onChange:function(t){return e.handleQueryUpdate(t,"item")},onBlur:this.handleQueryChange}))),r&&It.a.createElement("div",{className:"gf-form"},It.a.createElement(wt.InlineFormLabel,{width:10,tooltip:"Original query string, read-only"},"Legacy Query"),It.a.createElement(wt.Input,{value:r,readOnly:!0})))},t}(xt.PureComponent),Mt=function(){return(Mt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},jt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},Ft=wt.LegacyForms.Select,qt=wt.LegacyForms.FormField,Bt=wt.LegacyForms.Switch,Vt=["mysql","postgres","influxdb"],Ht=function(e,t,n){return function(r){var a;n(Mt(Mt({},t),{jsonData:Mt(Mt({},t.jsonData),(a={},a[e]=r.currentTarget.value,a))}))}},Gt=function(e,t,n){return function(r){var a;n(Mt(Mt({},t),{jsonData:Mt(Mt({},t.jsonData),(a={},a[e]=r.target.checked,a))}))}},zt=function(e,t,n){return function(r){var a;n(Mt(Mt({},t),{secureJsonData:Mt(Mt({},t.secureJsonData),(a={},a[e]=r.currentTarget.value,a))}))}},Ut=function(e,t,n){return function(r){var a;n(Mt(Mt({},t),{secureJsonFields:Mt(Mt({},t.secureJsonFields),(a={},a[e]=!1,a))}))}},Qt=function(){var e=Object(a.getDataSourceSrv)().getAll();return e=e.filter((function(e){return Vt.includes(e.type)}))},$t=function(){return Qt().map((function(e){return{label:e.name,value:e.id}}))},Xt=n(45),Wt=n.n(Xt),Yt=n(15),Zt=n.n(Yt);Wt.a.module("grafana.directives").directive("addMetricFunction",["$compile",function(e){return{link:function(t,n){var r=T(),a=function(e){return i.a.reduce(e,(function(e,t){return i.a.each(t,(function(t){e.push(t.name)})),e}),[])}(r);t.functionMenu=function(e){return i.a.map(e,(function(e,t){return{text:t,submenu:i.a.map(e,(function(e){return{text:e.name,click:"ctrl.addFunction('"+e.name+"')"}}))}}))}(r);var o=Zt()('<input type="text" class="gf-form-input" spellcheck="false" style="display:none"></input>'),s=Zt()('<a  class="gf-form-label tight-form-func dropdown-toggle query-part" tabindex="1" gf-dropdown="functionMenu" data-toggle="dropdown"><i class="fa fa-plus"></i></a>');o.appendTo(n),s.appendTo(n),o.attr("data-provide","typeahead"),o.typeahead({source:a,minLength:1,items:10,updater:function(e){var n=function(e){return v[e]}(e);if(n||(e=e.toLowerCase(),n=i.a.find(a,(function(t){return 0===t.toLowerCase().indexOf(e)}))))return t.$apply((function(){t.ctrl.addFunction(n)})),o.trigger("blur"),""}}),s.click((function(){s.hide(),o.show(),o.focus()})),o.keyup((function(){n.toggleClass("open",""===o.val())})),o.blur((function(){setTimeout((function(){o.val(""),o.hide(),s.show(),n.removeClass("open")}),200)})),e(n.contents())(t)}}}]);var Jt=n(30),Kt=n.n(Jt);var en=function(e){return e.description?It.a.createElement("span",{className:"pointer fa fa-question-circle",onClick:e.onDescriptionShow}):It.a.createElement("span",{className:"pointer fa fa-question-circle",onClick:function(){window.open("https://alexanderzobnin.github.io/grafana-zabbix/reference/functions/#"+e.name,"_blank")}})},tn=function(e){var t=e.func,n=e.onMoveLeft,r=e.onMoveRight,a=e.onRemove,o=e.onDescriptionShow;return It.a.createElement("div",{style:{display:"flex",width:"60px",justifyContent:"space-between"}},It.a.createElement("span",{className:"pointer fa fa-arrow-left",onClick:function(){return n(t)}}),It.a.createElement(en,{name:t.def.name,description:t.def.description,onDescriptionShow:o}),It.a.createElement("span",{className:"pointer fa fa-remove",onClick:function(){return a(t)}}),It.a.createElement("span",{className:"pointer fa fa-arrow-right",onClick:function(){return r(t)}}))},nn=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),rn=function(){return(rn=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},an=function(e){function t(t){var n=e.call(this,t)||this;return n.triggerRef=It.a.createRef(),n.renderContent=function(e){var t=e.updatePopperPosition,r=n.props,a=r.onMoveLeft,o=r.onMoveRight,i=r.func.def,s=i.name,u=i.description;return n.state.showingDescription?It.a.createElement("div",{style:{overflow:"auto",maxHeight:"30rem",textAlign:"left",fontWeight:"normal"}},It.a.createElement("h4",{style:{color:"white"}}," ",s," "),It.a.createElement("div",null,u)):It.a.createElement(tn,rn({},n.props,{onMoveLeft:function(){a(n.props.func),t()},onMoveRight:function(){o(n.props.func),t()},onDescriptionShow:function(){n.setState({showingDescription:!0},(function(){t()}))}}))},n.state={showingDescription:!1},n}return nn(t,e),t.prototype.render=function(){var e=this;return It.a.createElement(wt.PopoverController,{content:this.renderContent,placement:"top",hideAfter:300},(function(t,n,r){return It.a.createElement(It.a.Fragment,null,e.triggerRef&&It.a.createElement(wt.Popover,rn({},r,{referenceElement:e.triggerRef.current,wrapperClassName:"popper",className:"popper__background",onMouseLeave:function(){e.setState({showingDescription:!1}),n()},onMouseEnter:t,renderArrow:function(e){var t=e.arrowProps,n=e.placement;return It.a.createElement("div",rn({className:"popper__arrow","data-placement":n},t))}})),It.a.createElement("span",{ref:e.triggerRef,onClick:r.show?n:t,onMouseLeave:function(){n(),e.setState({showingDescription:!1})},style:{cursor:"pointer"}},e.props.func.def.name))}))},t}(It.a.PureComponent);function on(e,t){return{restrict:"A",link:function(n,r){var a=Zt()('\n    <zbx-function-editor\n      func="func"\n      onRemove="ctrl.handleRemoveFunction"\n      onMoveLeft="ctrl.handleMoveLeft"\n      onMoveRight="ctrl.handleMoveRight"\n    /><span>(</span>\n  '),o=n.ctrl,s=n.func,u=!1,c=0,l=null;function p(e){var t=Zt()(this),n=t.prev(".comma"),r=t.next();r.val(s.params[e]),n.removeClass("query-part__last"),t.hide(),r.show(),r.focus(),r.select();var a=r.data("typeahead");a&&(r.val(""),a.lookup())}function f(e){return e<s.def.params.length?s.def.params[e]:i.a.last(s.def.params).multiple?i.a.assign({},i.a.last(s.def.params),{optional:!0}):{}}function m(e,r){var a=Zt()(e);clearTimeout(l),l=null;var i=a.prev(),p=i.prev(".comma"),m=a.val();(""!==m||f(r).optional)&&(s.updateParam(m,r),i.html(m?t.highlightVariablesAsHtml(m):"&nbsp;")),c!==s.params.length&&(u||(u=!0,setTimeout((function(){y(),u=!1}),200))),n.$apply((function(){o.targetChanged()})),i.hasClass("query-part__last")&&""===m?p.addClass("query-part__last"):i.removeClass("query-part__last"),a.hide(),i.show()}function d(e){var t=this;l=setTimeout((function(){m(t,e)}),200)}function h(e,t){13===t.which&&Zt()(this).blur()}function v(){this.style.width=8*(3+this.value.length)+"px"}function g(){a.appendTo(r);for(var o=i.a.clone(s.def.params),u=i.a.last(s.def.params);s.params.length>=o.length&&u&&u.multiple;)o.push(i.a.assign({},u,{optional:!0}));i.a.each(o,(function(e,n){if(e.optional&&s.params.length<n)return!1;var a=t.highlightVariablesAsHtml(s.params[n]),o=null!=a,u=n>=s.params.length-1&&e.optional&&!o;u&&e.multiple&&(a="+"),n>0&&Zt()('<span class="comma'+(u?" query-part__last":"")+'">, </span>').appendTo(r);var l=Zt()('<a ng-click="" class="graphite-func-param-link'+(u?" query-part__last":"")+'">'+(o?a:"&nbsp;")+"</a>"),g=Zt()('<input type="text" style="display:none" class="input-small tight-form-func-param"></input>');return g.attr("placeholder",e.name),c++,l.appendTo(r),g.appendTo(r),g.blur(i.a.partial(d,n)),g.keyup(v),g.keypress(i.a.partial(h,n)),l.click(i.a.partial(p,n)),e.options&&function(e,t){e.attr("data-provide","typeahead");var n=f(t).options;"int"!==f(t).type&&"float"!==f(t).type||(n=i.a.map(n,(function(e){return e.toString()}))),e.typeahead({source:n,minLength:0,items:20,updater:function(n){return e.val(n),m(e[0],t),n}}),e.data("typeahead").lookup=function(){return this.query=this.$element.val()||"",this.process(this.source)}}(g,n),!0})),Zt()("<span>)</span>").appendTo(r),e(r.contents())(n)}function y(){r.children().remove(),g(),n.func.added&&(n.func.added=!1,setTimeout((function(){r.find(".graphite-func-param-link").first().click()}),10))}o.handleRemoveFunction=function(e){o.removeFunction(e)},o.handleMoveLeft=function(e){o.moveFunction(e,-1)},o.handleMoveRight=function(e){o.moveFunction(e,1)},y()}}}Kt.a.directive("zabbixFunctionEditor",on),function(e,t,n){Kt.a.directive(e,["reactDirective",function(e){return e(t,n)}])}("zbxFunctionEditor",an,["func","onRemove","onMoveLeft","onMoveRight"]),n.d(t,"plugin",(function(){return un}));var sn=function(){function e(){}return e.templateUrl="datasource-zabbix/partials/annotations.editor.html",e}();Tt.templateUrl="datasource-zabbix/partials/query.editor.html",Object(a.loadPluginCss)({dark:"plugins/alexanderzobnin-zabbix-app/css/grafana-zabbix.dark.css",light:"plugins/alexanderzobnin-zabbix-app/css/grafana-zabbix.light.css"});var un=new r.DataSourcePlugin(ut).setConfigEditor((function(e){var t,n,r=e.options,o=e.onOptionsChange,i=Object(xt.useState)(null),s=i[0],u=i[1],c=Object(xt.useState)(""),l=c[0],p=c[1];return Object(xt.useEffect)((function(){var e=r.jsonData,t=r.secureJsonFields,n=e.password,i=jt(e,["password"]);if((null==t?void 0:t.password)||(r.secureJsonData||(r.secureJsonData={}),r.secureJsonData.password=n),o(Mt(Mt({},r),{jsonData:Mt({trends:!0,trendsFrom:"",trendsRange:"",cacheTTL:""},i)})),r.jsonData.dbConnectionEnable)if(r.jsonData.dbConnectionDatasourceId){var s=Qt().find((function(e){return e.id===r.jsonData.dbConnectionDatasourceId}));u({label:s.name,value:s.id}),p(s.type)}else{var c=r.jsonData.dbConnectionDatasourceName;Object(a.getDataSourceSrv)().get(c).then((function(e){if(e){var t=Qt().find((function(t){return t.id===e.id}));u({label:t.name,value:t.id}),p(t.type),o(Mt(Mt({},r),{jsonData:Mt(Mt({},r.jsonData),{dbConnectionDatasourceId:e.id})}))}}))}}),[]),It.a.createElement(It.a.Fragment,null,It.a.createElement(wt.DataSourceHttpSettings,{defaultUrl:"http://localhost:9200",dataSourceConfig:r,showAccessOptions:!0,onChange:o}),It.a.createElement("div",{className:"gf-form-group"},It.a.createElement("h3",{className:"page-heading"},"Zabbix API details"),It.a.createElement("div",{className:"gf-form max-width-25"},It.a.createElement(qt,{labelWidth:7,inputWidth:15,label:"Username",value:r.jsonData.username||"",onChange:Ht("username",r,o),required:!0})),It.a.createElement("div",{className:"gf-form max-width-25"},(null===(t=r.secureJsonFields)||void 0===t?void 0:t.password)?It.a.createElement(It.a.Fragment,null,It.a.createElement(qt,{labelWidth:7,inputWidth:15,label:"Password",disabled:!0,value:"",placeholder:"Configured"}),It.a.createElement(wt.Button,{onClick:Ut("password",r,o)},"Reset")):It.a.createElement(qt,{labelWidth:7,inputWidth:15,label:"Password",type:"password",value:(null===(n=r.secureJsonData)||void 0===n?void 0:n.password)||r.jsonData.password||"",onChange:zt("password",r,o),required:!0})),It.a.createElement(Bt,{label:"Trends",labelClass:"width-7",checked:r.jsonData.trends,onChange:Gt("trends",r,o)}),r.jsonData.trends&&It.a.createElement(It.a.Fragment,null,It.a.createElement("div",{className:"gf-form"},It.a.createElement(qt,{labelWidth:7,inputWidth:4,label:"After",value:r.jsonData.trendsFrom||"",placeholder:"7d",onChange:Ht("trendsFrom",r,o),tooltip:"Time after which trends will be used.\n                  Best practice is to set this value to your history storage period (7d, 30d, etc)."})),It.a.createElement("div",{className:"gf-form"},It.a.createElement(qt,{labelWidth:7,inputWidth:4,label:"Range",value:r.jsonData.trendsRange||"",placeholder:"4d",onChange:Ht("trendsRange",r,o),tooltip:"Time range width after which trends will be used instead of history.\n                  It's better to set this value in range of 4 to 7 days to prevent loading large amount of history data."}))),It.a.createElement("div",{className:"gf-form"},It.a.createElement(qt,{labelWidth:7,inputWidth:4,label:"Cache TTL",value:r.jsonData.cacheTTL||"",placeholder:"1h",onChange:Ht("cacheTTL",r,o),tooltip:"Zabbix data source caches metric names in memory. Specify how often data will be updated."}))),It.a.createElement("div",{className:"gf-form-group"},It.a.createElement("h3",{className:"page-heading"},"Direct DB Connection"),It.a.createElement(Bt,{label:"Enable",labelClass:"width-9",checked:r.jsonData.dbConnectionEnable,onChange:Gt("dbConnectionEnable",r,o)}),r.jsonData.dbConnectionEnable&&It.a.createElement(It.a.Fragment,null,It.a.createElement("div",{className:"gf-form"},It.a.createElement(wt.InlineFormLabel,{width:9},"Data Source"),It.a.createElement(Ft,{width:16,options:$t(),value:s})),"influxdb"===l&&It.a.createElement("div",{className:"gf-form"},It.a.createElement(qt,{labelWidth:9,inputWidth:16,label:"Retention Policy",value:r.jsonData.dbConnectionRetentionPolicy||"",placeholder:"Retention policy name",onChange:Ht("dbConnectionRetentionPolicy",r,o),tooltip:"Specify retention policy name for fetching long-term stored data (optional).\n                    Leave it blank if only default retention policy used."})))),It.a.createElement("div",{className:"gf-form-group"},It.a.createElement("h3",{className:"page-heading"},"Other"),It.a.createElement(Bt,{label:"Disable acknowledges for read-only users",labelClass:"width-20",checked:r.jsonData.disableReadOnlyUsersAck,onChange:Gt("disableReadOnlyUsersAck",r,o)})))})).setQueryCtrl(Tt).setAnnotationQueryCtrl(sn).setVariableQueryEditor(Lt)}])}));
//# sourceMappingURL=module.js.map